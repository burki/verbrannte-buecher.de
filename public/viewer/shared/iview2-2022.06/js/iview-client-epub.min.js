var mycore,__extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();!function(e){var t,n,o,r;t=e.viewer||(e.viewer={}),n=t.widgets||(t.widgets={}),o=n.epub||(n.epub={}),r=function(s){function e(e,t,n,o,r){var i=s.call(this,e,t,null!=r?r.href:"root",n,o,new MyCoReMap,function(e){return e(null)})||this;return i.epubChapter=r,i}return __extends(e,s),e}(e.viewer.model.StructureChapter),o.EpubStructureChapter=r}(mycore||(mycore={})),function(e){var t,n,i,o;t=e.viewer||(e.viewer={}),n=t.widgets||(t.widgets={}),i=n.epub||(n.epub={}),o=function(){function e(){}return e.prototype.convertToChapter=function(e,t){var n=this,o=[],r=new i.EpubStructureChapter(t,void 0===t?"root":"",e.label,o,e);return null!=e.subitems&&e.subitems.map(function(e){return n.convertToChapter(e,r)}).forEach(function(e){o.push(e)}),r},e}(),i.EpubStructureBuilder=o}(mycore||(mycore={})),function(p){var a,e,t;a=p.viewer||(p.viewer={}),e=a.components||(a.components={}),t=function(o){function e(e,t){var n=o.call(this)||this;return n.epubSettings=e,n.appContainer=t,n.zoomInPercent=100,n}return __extends(e,o),Object.defineProperty(e.prototype,"handlesEvents",{get:function(){var e=[];return"epub"!==this.epubSettings.doctype||(e.push(p.viewer.widgets.toolbar.events.ButtonPressedEvent.TYPE),e.push(p.viewer.components.events.ChapterChangedEvent.TYPE),e.push(p.viewer.components.events.RequestStateEvent.TYPE),e.push(p.viewer.components.events.RestoreStateEvent.TYPE),e.push(p.viewer.components.events.ProvideToolbarModelEvent.TYPE)),e},enumerable:!0,configurable:!0}),e.prototype.handle=function(e){if("epub"===this.epubSettings.doctype)if(e.type!==p.viewer.components.events.ChapterChangedEvent.TYPE)if(e.type!==p.viewer.components.events.ProvideToolbarModelEvent.TYPE)if(e.type!==p.viewer.widgets.toolbar.events.ButtonPressedEvent.TYPE)if(e.type!==p.viewer.components.events.RequestStateEvent.TYPE)e.type!==p.viewer.components.events.RestoreStateEvent.TYPE||(t=e).restoredState.has("start")&&this.rendition.display(t.restoredState.get("start"));else{var t=e;this.handleRequestStateEvent(t)}else{var n=e;this.handleButtonPressedEvent(n)}else{var o=e;this.handleProvideToolbarModelEvent(o)}else{var r=e;this.handleChapterChangedEvent(r)}},e.prototype.init=function(){var s=this;if("epub"===this.epubSettings.doctype){this.trigger(new p.viewer.components.events.WaitForEvent(this,p.viewer.components.events.ProvideToolbarModelEvent.TYPE));var e=document.createElement("div");e.style.width="100%",e.style.height="100%",e.style.background="white",e.style.paddingLeft="5%",this.trigger(new p.viewer.components.events.ShowContentEvent(this,jQuery(e),p.viewer.components.events.ShowContentEvent.DIRECTION_CENTER));var t=ePub(this.epubSettings.epubPath,{openAs:"directory",method:"goToTheElse!"});this.rendition=t.renderTo(e,{manager:"continuous",flow:"scrolled",width:"100%",height:"100%",offset:1}),this.rendition.display();var n=new Debounce(100,function(e){s.rendition.resize()});jQuery(e).bind("iviewResize",function(){n.call(!1)});var u=new MyCoReMap;t.loaded.navigation.then(function(e){var t=[],n=new a.widgets.epub.EpubStructureChapter(null,"root",s.epubSettings.filePath,t,null),o=new a.widgets.epub.EpubStructureBuilder;e.forEach(function(e){t.push(o.convertToChapter(e,n))});var r,i=new p.viewer.model.StructureModel(n,[],new MyCoReMap,new MyCoReMap,new MyCoReMap,!1);(r=function(e){u.set(e.id,e),e.chapter.forEach(function(e){r(e)})})(n),s.trigger(new p.viewer.components.events.StructureModelLoadedEvent(s,i))}),this.rendition.on("relocated",function(e){e.start.href!==s.currentHref&&(s.currentHref=e.start.href)}),this.trigger(new p.viewer.components.events.WaitForEvent(this,p.viewer.components.events.RestoreStateEvent.TYPE))}},e.prototype.handleRequestStateEvent=function(e){var t=this.rendition.currentLocation();e.stateMap.set("start",t.start.cfi),e.stateMap.set("end",t.end.cfi)},e.prototype.handleButtonPressedEvent=function(e){"ZoomInButton"===e.button.id&&(this.zoomInPercent+=25,this.rendition.themes.fontSize(this.zoomInPercent+"%")),"ZoomOutButton"===e.button.id&&(this.zoomInPercent-=25,this.rendition.themes.fontSize(this.zoomInPercent+"%"))},e.prototype.handleProvideToolbarModelEvent=function(e){e.model._zoomControllGroup.removeComponent(e.model._rotateButton),e.model._zoomControllGroup.removeComponent(e.model._zoomFitButton),e.model._zoomControllGroup.removeComponent(e.model._zoomWidthButton),e.model.removeGroup(e.model._imageChangeControllGroup);var t=e.model.getGroup(e.model._layoutControllGroup.name);null!=t&&e.model.removeGroup(e.model._layoutControllGroup)},e.prototype.handleChapterChangedEvent=function(e){var t=e.chapter;null==t&&void 0===t||(this.currentHref=t.id,null!==t.epubChapter&&e.component!==this&&this.rendition.display(t.epubChapter.href))},e}(e.ViewerComponent),e.MyCoReEpubDisplayComponent=t}(mycore||(mycore={})),addViewerComponent(mycore.viewer.components.MyCoReEpubDisplayComponent);