var AltoElementType,mycore,__extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();!function(e){var t,n,i,r;t=e.viewer||(e.viewer={}),n=t.widgets||(t.widgets={}),i=n.mets||(n.mets={}),r=function(l){function e(e,t,n,i,r,a,o){var s=l.call(this,t,n,i,r,a,o)||this;return s.smLinkMap=e,s.altoPresent=o,s}return __extends(e,l),e}(t.model.StructureModel),i.MetsStructureModel=r}(mycore||(mycore={})),function(e){var c,t,n,i;c=e.viewer||(e.viewer={}),t=c.widgets||(c.widgets={}),n=t.mets||(t.mets={}),i=function(){function p(e,t){this.metsDocument=e,this.tilePathBuilder=t,this.hrefResolverElement=document.createElement("a")}var e;return p.prototype.processMets=function(){var n=this,e=this.getFiles("IVIEW2");0==e.length&&(e=this.getFiles("MASTER")),this._idFileMap=this.getIdFileMap(e);var i=new MyCoReMap;return this.getGroups().map(function(e){return e.getAttribute("USE")}).map(function(e){return e.toUpperCase()}).filter(function(e){return"MASTER"!=e}).forEach(function(e){var t=n.getFiles(e);i.set(e,t),n._idFileMap.mergeIn(n.getIdFileMap(t))}),this._chapterIdMap=new MyCoReMap,this._idPhysicalFileMap=this.getIdPhysicalFileMap(),this._smLinkMap=new MyCoReMap,this._chapterImageMap=new MyCoReMap,this._imageChapterMap=new MyCoReMap,this._improvisationMap=new MyCoReMap,this._metsChapter=this.processChapter(null,this.getFirstElementChild(this.getStructMap("LOGICAL"))),this._imageHrefImageMap=new MyCoReMap,this._imageList=[],this._idImageMap=new MyCoReMap,this.processImages(),this._structureModel=new t.mets.MetsStructureModel(this._smLinkMap,this._metsChapter,this._imageList,this._chapterImageMap,this._imageChapterMap,this._imageHrefImageMap,i.has("ALTO")&&0<i.get("ALTO").length),this._structureModel},p.prototype.getStructMap=function(e){var t="//mets:structMap[@TYPE='"+e+"']";return singleSelectShim(this.metsDocument,t,p.NS_MAP)},p.prototype.getGroups=function(){return getNodesShim(this.metsDocument,"//mets:fileSec//mets:fileGrp",this.metsDocument.documentElement,p.NS_MAP,4,null)},p.prototype.getFiles=function(e){var t="//mets:fileSec//mets:fileGrp[@USE='"+e+"']",n=singleSelectShim(this.metsDocument,t,p.NS_MAP),i=[];return null!=n&&(i=XMLUtil.nodeListToNodeArray(n.childNodes)),i},p.prototype.getStructLinks=function(){var e=singleSelectShim(this.metsDocument,"//mets:structLink",p.NS_MAP),t=[];return XMLUtil.iterateChildNodes(e,function(e){(e instanceof Element||"getAttribute"in e)&&t.push(e)}),t},p.prototype.processChapter=function(e,t){if("mets:mptr"!=t.nodeName.toString()){var n=new c.model.StructureChapter(e,t.getAttribute("TYPE"),t.getAttribute("ID"),t.getAttribute("LABEL")),i=t.childNodes;this._chapterIdMap.set(n.id,n);for(var r=0;r<i.length;r++){var a=i[r];(a instanceof Element||"getAttribute"in a)&&(-1!=a.nodeName.indexOf("fptr")?this.processFPTR(n,a):-1!=a.nodeName.indexOf("div")&&n.chapter.push(this.processChapter(n,a)))}return n}},p.prototype.processFPTR=function(t,e){var n=this,i=this.getFirstElementChild(e);i.nodeName.indexOf("seq")?XMLUtil.iterateChildNodes(i,function(e){(e instanceof Element||"getAttribute"in e)&&n.parseArea(t,e)}):i.nodeName.indexOf("area")&&this.parseArea(t,i)},p.prototype.parseArea=function(e,t){var n;e.additional.has("blocklist")?n=e.additional.get("blocklist"):(n=[],e.additional.set("blocklist",n));var i=t.getAttribute("FILEID");if(null==i)throw"@FILEID of mets:area is required but not set!";var r=this.getAttributeNs(this.getFirstElementChild(this._idFileMap.get(i)),"xlink","href");if(null==r)throw"couldn't find href of @FILEID in mets:area! "+i;var a={fileId:r};"IDREF"==t.getAttribute("BETYPE")?(a.fromId=t.getAttribute("BEGIN"),a.toId=t.getAttribute("END")):console.warn("mets:area/@FILEID='"+r+"' has no BETYPE attribute"),n.push(a)},p.prototype.getIdFileMap=function(e){var i=new MyCoReMap;return e.forEach(function(e,t){if(e instanceof Element||"getAttribute"in e){var n=e;i.set(n.getAttribute("ID"),n)}}),i},p.prototype.getIdPhysicalFileMap=function(){for(var e=new MyCoReMap,t=this.getStructMap("PHYSICAL"),n=this.getFirstElementChild(t).childNodes,i=0;i<n.length;i++){var r=n[i];"getAttribute"in r&&e.set(r.getAttribute("ID"),r)}return e},p.prototype.getFirstElementChild=function(e){return"firstElementChild"in e?e.firstElementChild:e.firstChild},p.prototype.getAttributeNs=function(e,t,n){return"getAttributeNS"in e?e.getAttributeNS(p.NS_MAP.get(t),n):e.getAttribute(t+":"+n)},p.prototype.processImages=function(){var r=this,a=1;this._idPhysicalFileMap.forEach(function(e,t){var n=r._idPhysicalFileMap.get(e),i=r.parseFile(n,a++);null!=i&&(r._imageList.push(i),r._idImageMap.set(e,i))}),this._imageList=this._imageList.sort(function(e,t){return e.order-t.order}),this.makeLinks(),this._imageList=this._imageList.filter(function(e){return r._imageChapterMap.has(e.id)}),this._imageList.forEach(function(e,t){e.order=t+1,r._imageHrefImageMap.set(e.href,e)})},p.prototype.makeLinks=function(){var i=this;this.getStructLinks().forEach(function(e){var t=i.getAttributeNs(e,"xlink","from"),n=i.getAttributeNs(e,"xlink","to");i.makeDirectLink(i._chapterIdMap.get(t),i._idImageMap.get(n))})},p.prototype.linkParentsIndirect=function(e,t){null==e.parent||this._chapterImageMap.has(e.parent.id)||(this.linkParentsIndirect(e.parent,t),this._improvisationMap.set(e.parent.id,!0),this._chapterImageMap.set(e.parent.id,t))},p.prototype.makeDirectLink=function(e,t){this.linkParentsIndirect(e,t);var n=!this._chapterImageMap.has(e.id),i=this._imageList.indexOf(this._chapterImageMap.get(e.id)),r=this._improvisationMap.has(e.id)&&this._improvisationMap.get(e.id);(n||i>this._imageList.indexOf(t)||r)&&(this._chapterImageMap.set(e.id,t),this._improvisationMap.set(e.id,!1)),this._imageChapterMap.has(t.id)||this._imageChapterMap.set(t.id,e),this._smLinkMap.has(e.id)||this._smLinkMap.set(e.id,[]),this._smLinkMap.get(e.id).push(t.href)},p.prototype.extractTranslationLanguage=function(e){return e.split("/")[1].split(".")[1]},p.prototype.parseFile=function(e,t){var o=this,n=e.getAttribute("TYPE"),i=e.getAttribute("ID"),r=parseInt(e.getAttribute("ORDER")||""+t,10),a=e.getAttribute("ORDERLABEL"),s=e.getAttribute("CONTENTIDS"),l=new MyCoReMap,h=null,d=null;this.hrefResolverElement.href="./";var u=this.hrefResolverElement.href;if(XMLUtil.iterateChildNodes(e,function(e){if(e instanceof Element||"getAttribute"in e){var t=e.getAttribute("FILEID"),n=o._idFileMap.get(t),i=o.getAttributeNs(o.getFirstElementChild(n),"xlink","href"),r=n.getAttribute("MIMETYPE");o.hrefResolverElement.href=i,i=o.hrefResolverElement.href.substr(u.length);var a=n.parentNode.getAttribute("USE");"MASTER"===a||"IVIEW2"===a?(h=i,d=r):"ALTO"===a?l.set(p.ALTO_TEXT,i):0==a.indexOf("TEI.")?l.set(a,i):console.warn("Unknown File Group : "+a)}}),null===h)return console.warn("Unable to find MASTER|IVIEW2 file for "+i),null;if(h.indexOf("http:")+h.indexOf("file:")+h.indexOf("urn:")!==-3){var g=document.createElement("a");g.href=h,h=g.pathname}return new c.model.StructureImage(n,i,r,a,h,d,function(e){e(o.tilePathBuilder(h))},l,s)},p.METS_NAMESPACE_URI="http://www.loc.gov/METS/",p.XLINK_NAMESPACE_URI="http://www.w3.org/1999/xlink",p.ALTO_TEXT="AltoHref",p.TEI_TRANSCRIPTION="TeiTranscriptionHref",p.TEI_TRANSLATION="TeiTranslationHref",p.NS_RESOLVER={lookupNamespaceURI:function(e){return"mets"==e?p.METS_NAMESPACE_URI:null}},p.NS_MAP=((e=new MyCoReMap).set("mets",p.METS_NAMESPACE_URI),e.set("xlink",p.XLINK_NAMESPACE_URI),e),p}(),n.MetsStructureBuilder=i}(mycore||(mycore={})),function(e){var t,n,r,i;t=e.viewer||(e.viewer={}),n=t.widgets||(t.widgets={}),r=n.mets||(n.mets={}),i=function(){function e(){}return e.loadModel=function(e,n){var i=new ViewerPromise,t={url:e,success:function(e){var t=new r.MetsStructureBuilder(e,n);i.resolve({model:t.processMets(),document:e})},error:function(e,t,n){i.reject(n)}};return jQuery.ajax(t),i},e}(),r.IviewMetsProvider=i}(mycore||(mycore={})),function(e){var t,n,i,r;t=e.viewer||(e.viewer={}),n=t.components||(t.components={}),i=n.events||(n.events={}),r=function(i){function r(e,t){var n=i.call(this,e,r.TYPE)||this;return n.mets=t,n}return __extends(r,i),r.TYPE="MetsLoadedEvent",r}(i.MyCoReImageViewerEvent),i.MetsLoadedEvent=r}(mycore||(mycore={})),function(e){var t,n,i,r,a;t=e.viewer||(e.viewer={}),n=t.widgets||(t.widgets={}),i=n.alto||(n.alto={}),r=function(e,t,n){this.file=e,this.type=t,this.pageOrder=n},a=function(h){function d(e,t,n,i,r,a,o,s){var l=h.call(this,e,d.TYPE,s)||this;return l.hpos=t,l.vpos=n,l.width=i,l.height=r,l.from=a,l.to=o,l}return __extends(d,h),d.TYPE="AltoWordChange",d}(i.AltoChange=r),i.AltoWordChange=a}(mycore||(mycore={})),function(r){var e,a,o,t;e=r.viewer||(r.viewer={}),a=e.components||(e.components={}),o=r.viewer.components.events.ShowContentEvent,t=function(i){function e(e,t){var n=i.call(this)||this;return n.settings=e,n.container=t,n.errorSync=Utils.synchronize([function(e){return null!=e.lm&&e.error}],function(e){new r.viewer.widgets.modal.ViewerErrorModal(n.settings.mobile,e.lm.getTranslation("noStructFileShort"),e.lm.getFormatedTranslation("noStructFile",'<a href="mailto:"'+n.settings.adminMail+">"+n.settings.adminMail+"</a>"),n.settings.webApplicationBaseURL+"/modules/iview2/img/sad-emotion-egg.jpg",n.container[0]).show(),e.trigger(new o(n,jQuery(),r.viewer.widgets.layout.IviewBorderLayout.DIRECTION_WEST,0))}),n.error=!1,n.lm=null,n.mm=null,n}return __extends(e,i),e.prototype.postProcessChapter=function(e){var t=this;if((null===e.label||void 0===e.label||""===e.label)&&null!==e.type&&void 0!==e.type&&""!==e.type){var n=this.buildTranslationKey(e.type||"");this.lm.hasTranslation(n)&&(e._label=this.lm.getTranslation(n))}e.chapter.forEach(function(e){t.postProcessChapter(e)})},e.prototype.buildTranslationKey=function(e){return"dfgStructureSet."+e.replace("- ","")},e.prototype.structFileLoaded=function(e){this.postProcessChapter(e._rootChapter);var t=new a.events.StructureModelLoadedEvent(this,e);this.trigger(t),this.vStructFileLoaded=!0,this.vEventToTrigger=t;var n=this.settings.filePath,i=null;e._imageList.forEach(function(e){"/"+e.href!==n&&e.href!==n||(i=e)}),null!=i&&this.trigger(new a.events.ImageSelectedEvent(this,i))},Object.defineProperty(e.prototype,"handlesEvents",{get:function(){return[a.events.LanguageModelLoadedEvent.TYPE]},enumerable:!0,configurable:!0}),e}(a.ViewerComponent),a.MyCoReStructFileComponent=t}(mycore||(mycore={})),function(r){var e,a,t;e=r.viewer||(r.viewer={}),a=e.components||(e.components={}),t=function(i){function e(e,t){var n=i.call(this,e,t)||this;return n.settings=e,n.container=t,n.structFileAndLanguageSync=Utils.synchronize([function(e){return null!=e.mm},function(e){return null!=e.lm}],function(e){n.structFileLoaded(n.mm.model),n.trigger(new a.events.MetsLoadedEvent(n,n.mm))}),n}return __extends(e,i),e.prototype.init=function(){var n=this,e=this.settings;if("mets"===e.doctype){"/"!=e.imageXmlPath.charAt(e.imageXmlPath.length-1)&&(e.imageXmlPath=e.imageXmlPath+"/"),"/"!=e.tileProviderPath.charAt(e.tileProviderPath.length-1)&&(e.tileProviderPath=e.tileProviderPath+"/"),this.vStructFileLoaded=!1;var t=r.viewer.widgets.mets.IviewMetsProvider.loadModel(this.settings.metsURL,function(e){return n.settings.tileProviderPath.split(",")[0]+n.settings.derivate+"/"+e+"/0/0/0.jpg"});t.then(function(e){var t=e.model;if(n.trigger(new a.events.WaitForEvent(n,a.events.LanguageModelLoadedEvent.TYPE)),null===t)return n.error=!0,void n.errorSync(n);n.mm=e,n.structFileAndLanguageSync(n)}),t.onreject(function(){n.trigger(new a.events.WaitForEvent(n,a.events.LanguageModelLoadedEvent.TYPE)),n.error=!0,n.errorSync(n)}),this.trigger(new a.events.ComponentInitializedEvent(this))}},e.prototype.handle=function(e){if(e.type===a.events.LanguageModelLoadedEvent.TYPE){var t=e;this.lm=t.languageModel,this.errorSync(this),this.structFileAndLanguageSync(this)}},e}(a.MyCoReStructFileComponent),a.MyCoReMetsComponent=t}(mycore||(mycore={})),addViewerComponent(mycore.viewer.components.MyCoReMetsComponent),function(e){var t,n;t=e.viewer||(e.viewer={}),function(e){var t=function(){function a(){}return a.getInformation=function(e,n,i,r){void 0===r&&(r=function(e){});var t={url:e+n+"/imageinfo.xml",async:!0,success:function(e){var t=a.proccessXML(e,n);i(t)},error:function(e,t,n){r(n)}};jQuery.ajax(t)},a.proccessXML=function(e,t){var n=jQuery(e.childNodes[0]);return new i(n.attr("derivate"),t,parseInt(n.attr("tiles")),parseInt(n.attr("width")),parseInt(n.attr("height")),parseInt(n.attr("zoomLevel")))},a}();e.XMLImageInformationProvider=t;var i=function(){function e(e,t,n,i,r,a){this._derivate=e,this._path=t,this._tiles=n,this._width=i,this._height=r,this._zoomlevel=a}return Object.defineProperty(e.prototype,"derivate",{get:function(){return this._derivate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tiles",{get:function(){return this._tiles},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zoomlevel",{get:function(){return this._zoomlevel},enumerable:!0,configurable:!0}),e}();e.XMLImageInformation=i}((n=t.widgets||(t.widgets={})).image||(n.image={}))}(mycore||(mycore={})),function(e){var t,n,i,r;t=e.viewer||(e.viewer={}),n=t.widgets||(t.widgets={}),i=n.canvas||(n.canvas={}),r=function(){function c(e,t,n,i){this.id=e,this.width=t,this.height=n,this.vTiles=new MyCoReMap,this.vLoadingTiles=new MyCoReMap,this.vBackBuffer=document.createElement("canvas"),this.vBackBufferArea=null,this.vBackBufferAreaZoom=null,this.vPreviewBackBuffer=document.createElement("canvas"),this.vPreviewBackBufferArea=null,this.vPreviewBackBufferAreaZoom=null,this.vImgPreviewLoaded=!1,this.vImgNotPreviewLoaded=!1,this.htmlContent=new ViewerProperty(this,"htmlContent"),this.vTilePath=i,this.loadTile(new Position3D(0,0,0))}return Object.defineProperty(c.prototype,"size",{get:function(){return new Size2D(this.width,this.height)},enumerable:!0,configurable:!0}),c.prototype.draw=function(e,t,n,i){(t.pos.x<0||t.pos.y<0)&&(t=new Rect(t.pos.max(0,0),t.size));var r=Math.min(this.getZoomLevel(n),this.maxZoomLevel()),a=this.scaleForLevel(r),o=n/a,s=c.TILE_SIZE/a,l=Math.floor(t.pos.x/s),h=Math.floor(t.pos.y/s),d=Math.ceil(Math.min(t.pos.x+t.size.width,this.size.width)/s),u=Math.ceil(Math.min(t.pos.y+t.size.height,this.size.height)/s);this.updateBackbuffer(l,h,d,u,r,i),e.save();var g=(l*s-t.pos.x)*n,p=(h*s-t.pos.y)*n;e.translate(g,p),e.scale(o,o),i?e.drawImage(this.vPreviewBackBuffer,0,0):e.drawImage(this.vBackBuffer,0,0),e.restore()},c.prototype.getHTMLContent=function(){return this.htmlContent},c.prototype.updateHTML=function(){void 0!==this.refreshCallback&&null!==this.refreshCallback&&this.refreshCallback()},c.prototype.clear=function(){this.abortLoadingTiles(),this.vBackBuffer.width=1,this.vBackBuffer.height=1;var e=this.vBackBufferAreaZoom=null,t=new Position3D(0,0,0),n=this.vTiles.has(t);n&&(e=this.vTiles.get(t)),this.vTiles.clear(),n&&this.vTiles.set(t,e),this.vLoadingTiles.clear()},c.prototype.updateBackbuffer=function(e,t,n,i,r,a){var o=new Rect(new Position2D(e,t),new Size2D(n-e,i-t));if(a){if(null!==this.vPreviewBackBufferArea&&!this.vImgPreviewLoaded&&this.vPreviewBackBufferArea.equals(o)&&r===this.vPreviewBackBufferAreaZoom)return;this.vPreviewBackBuffer.width=256*o.size.width,this.vPreviewBackBuffer.height=256*o.size.height,this.drawToBackbuffer(e,t,n,i,r,!0),this.vPreviewBackBufferArea=o,this.vPreviewBackBufferAreaZoom=r,this.vImgPreviewLoaded=!1}else{if(null!==this.vBackBufferArea&&!this.vImgNotPreviewLoaded&&this.vBackBufferArea.equals(o)&&r===this.vBackBufferAreaZoom)return;this.vBackBuffer.width=256*o.size.width,this.vBackBuffer.height=256*o.size.height,this.drawToBackbuffer(e,t,n,i,r,!1),this.vBackBufferArea=o,this.vBackBufferAreaZoom=r,this.vImgNotPreviewLoaded=!1}},c.prototype.abortLoadingTiles=function(){this.vLoadingTiles.forEach(function(e,t){delete t.src,delete t.onload,delete t.onerror}),this.vLoadingTiles.clear()},c.prototype.drawToBackbuffer=function(e,t,n,i,r,a){var o;o=a?this.vPreviewBackBuffer.getContext("2d"):this.vBackBuffer.getContext("2d");for(var s=e;s<n;s++)for(var l=t;l<i;l++){var h=new Position3D(s,l,r),d=this.loadTile(h),u=256*(s-e),g=256*(l-t);if(null!==d)o.drawImage(d,Math.floor(u),g,d.naturalWidth,d.naturalHeight);else{var p=this.getPreview(h);null!==p&&this.drawPreview(o,new Position2D(u,g),p)}}},c.prototype.drawPreview=function(e,t,n){n.areaToDraw.size.width=Math.min(n.areaToDraw.pos.x+n.areaToDraw.size.width,n.tile.naturalWidth)-n.areaToDraw.pos.x,n.areaToDraw.size.height=Math.min(n.areaToDraw.pos.y+n.areaToDraw.size.height,n.tile.naturalHeight)-n.areaToDraw.pos.y,e.drawImage(n.tile,n.areaToDraw.pos.x,n.areaToDraw.pos.y,n.areaToDraw.size.width,n.areaToDraw.size.height,t.x,t.y,n.areaToDraw.size.width*n.scale,n.areaToDraw.size.height*n.scale)},c.prototype.loadTile=function(t){var n=this;return this.vTiles.has(t)?this.vTiles.get(t):(this.vLoadingTiles.has(t)||this._loadTile(t,function(e){n.vTiles.set(t,e),void 0!==n.refreshCallback&&null!==n.refreshCallback&&(n.vImgPreviewLoaded=!0,n.vImgNotPreviewLoaded=!0,n.refreshCallback())},function(){console.error("Could not load tile : "+t.toString())}),null)},c.prototype.getPreview=function(e,t){if(void 0===t&&(t=1),this.vTiles.has(e))return{tile:this.vTiles.get(e),areaToDraw:new Rect(new Position2D(0,0),new Size2D(256,256)),scale:t};var n=e.z-1;if(n<0)return null;var i=new Position2D(Math.floor(e.x/2),Math.floor(e.y/2)),r=e.x%2,a=e.y%2,o=this.getPreview(new Position3D(i.x,i.y,n),2*t);if(null===o)return null;var s=new Size2D(o.areaToDraw.size.width/2,o.areaToDraw.size.height/2),l=new Position2D(o.areaToDraw.pos.x+s.width*r,o.areaToDraw.pos.y+s.height*a);return{tile:o.tile,areaToDraw:new Rect(l,s),scale:o.scale}},c.prototype.maxZoomLevel=function(){return Math.max(Math.ceil(Math.log(Math.max(this.width,this.height)/c.TILE_SIZE)/Math.LN2),0)},c.prototype.getZoomLevel=function(e){return Math.max(0,Math.ceil(this.maxZoomLevel()-Math.log(e)/Utils.LOG_HALF))},c.prototype.scaleForLevel=function(e){return Math.pow(.5,this.maxZoomLevel()-e)},c.prototype._loadTile=function(e,t,n){var i=this,r=Utils.hash(e.toString())%this.vTilePath.length,a=this.vTilePath[r],o=new Image;o.onload=function(){i.vLoadingTiles.remove(e),t(o)},o.onerror=function(){n()},o.src=ViewerFormatString(a,e),this.vLoadingTiles.set(e,o)},c.prototype.toString=function(){return this.vTilePath[0]},c.TILE_SIZE=256,c}(),i.TileImagePage=r}(mycore||(mycore={})),function(e){var t,n,i,r;t=e.viewer||(e.viewer={}),n=t.widgets||(t.widgets={}),i=n.alto||(n.alto={}),r=function(){function e(e,t,n,i){this._id=e,this._fontFamily=t,this._fontSize=n,this._fontStyle=i}return e.prototype.getId=function(){return this._id},e.prototype.getFontFamily=function(){return this._fontFamily},e.prototype.getFontSize=function(){return this._fontSize},e.prototype.getFontStyle=function(){return this._fontStyle},e}(),i.AltoStyle=r}(mycore||(mycore={})),function(e){e[e.ComposedBlock=0]="ComposedBlock",e[e.Illustration=1]="Illustration",e[e.GraphicalElement=2]="GraphicalElement",e[e.TextBlock=3]="TextBlock",e[e.TextLine=4]="TextLine",e[e.String=5]="String",e[e.SP=6]="SP",e[e.HYP=7]="HYP"}(AltoElementType||(AltoElementType={})),function(e){var t,n,i,r;t=e.viewer||(e.viewer={}),n=t.widgets||(t.widgets={}),i=n.alto||(n.alto={}),r=function(){function e(e,t,n,i,r,a,o,s){this._parent=e,this._type=t,this._id=n,this._width=i,this._height=r,this._hpos=a,this._vpos=o,this._wc=s,this._children=[],this._content=null,this._style=null}return e.prototype.getHeight=function(){return this._height},e.prototype.getHPos=function(){return this._hpos},e.prototype.getId=function(){return this._id},e.prototype.getType=function(){return this._type},e.prototype.getVPos=function(){return this._vpos},e.prototype.getWidth=function(){return this._width},e.prototype.getWordConfidence=function(){return this._wc},e.prototype.getChildren=function(){return this._children},e.prototype.setChildren=function(e){this._children=e},e.prototype.getContent=function(){return this._content},e.prototype.setContent=function(e){this._content=e},e.prototype.getStyle=function(){return this._style},e.prototype.setAltoStyle=function(e){this._style=e},e.prototype.getParent=function(){return this._parent},e.prototype.getBlockHPos=function(){return this._hpos},e.prototype.getBlockVPos=function(){return this._vpos},e.prototype.asRect=function(){return Rect.fromXYWH(this.getHPos(),this.getVPos(),this.getWidth(),this.getHeight())},e}(),i.AltoElement=r}(mycore||(mycore={})),function(e){var t,n,g,i;t=e.viewer||(e.viewer={}),n=t.widgets||(t.widgets={}),g=n.alto||(n.alto={}),i=function(){function e(e,t){if(this._allStyles={},this._rootChilds=new Array,this._allElements=new Array,this._allTextBlocks=new Array,this._allIllustrations=new Array,this._allLines=new Array,this._allComposedBlock=new Array,this._allGraphicalElements=new Array,this._pageWidth=-1,this._pageHeight=-1,null!=e)for(var n=e.getElementsByTagName("TextStyle"),i=0;i<n.length;i++){var r=n.item(i),a=this.createAltoStyle(r);this._allStyles[a.getId()]=a}var o=t.getElementsByTagName("Page").item(0);if(null!=o){this._pageWidth=parseInt(o.getAttribute("WIDTH")),this._pageHeight=parseInt(o.getAttribute("HEIGHT"));var s=o.getElementsByTagName("PrintSpace").item(0);null!=s&&(this._rootChilds=this.extractElements(s),this._allElements=this._allTextBlocks.concat(this._allIllustrations).concat(this._allComposedBlock).concat(this._allLines).concat(this._allGraphicalElements))}}return Object.defineProperty(e.prototype,"allElements",{get:function(){return this._allElements},enumerable:!0,configurable:!0}),e.prototype.createAltoStyle=function(e){var t=e.getAttribute("ID"),n=e.getAttribute("FONTFAMILY"),i=parseFloat(e.getAttribute("FONTSIZE")),r=e.getAttribute("FONTSTYLE");return new g.AltoStyle(t,n,i,r)},e.prototype.createAltoElement=function(e,t,n){var i=parseFloat(e.getAttribute("WIDTH")),r=parseFloat(e.getAttribute("HEIGHT")),a=parseFloat(e.getAttribute("HPOS")),o=parseFloat(e.getAttribute("VPOS")),s=parseFloat(e.getAttribute("WC")),l=e.getAttribute("ID"),h=e.getAttribute("STYLEREFS"),d=new g.AltoElement(n,t,l,i,r,a,o,s);if(null!=h){var u=this._allStyles[h];null!=u&&d.setAltoStyle(u)}return d},e.prototype.extractElements=function(e,t){void 0===t&&(t=null);for(var n=new Array,i=e.childNodes,r=0;r<i.length;r++){var a=i.item(r);if(a instanceof Element){var o=this.detectElementType(a);if(null!=o){var s=this.createAltoElement(a,o,t);switch(o){case AltoElementType.ComposedBlock:case AltoElementType.TextBlock:var l=this.extractElements(a,s);s.setChildren(l),n.push(s),o==AltoElementType.TextBlock&&this._allTextBlocks.push(s),o==AltoElementType.ComposedBlock&&this._allComposedBlock.push(s);break;case AltoElementType.Illustration:case AltoElementType.GraphicalElement:o==AltoElementType.Illustration&&this._allIllustrations.push(s),o==AltoElementType.GraphicalElement&&this._allGraphicalElements.push(s);break;case AltoElementType.TextLine:var h=this.extractElements(a,s);s.setChildren(h),n.push(s),this._allLines.push(s);break;case AltoElementType.String:case AltoElementType.SP:case AltoElementType.HYP:s.setContent(a.getAttribute("CONTENT")),n.push(s)}}}}return n},e.prototype.getBlocks=function(){return this._allTextBlocks},e.prototype.getBlockContent=function(e){for(var t="",n=0;n<this._allTextBlocks.length;n++)if(this._allTextBlocks[n].getId()==e){for(var i=this._allTextBlocks[n].getChildren(),r=0;r<i.length;r++)t+=this.getContainerContent(i[r].getId(),this._allLines);break}return t},e.prototype.getContainerContent=function(e,t){for(var n="",i=0;i<t.length;i++)if(t[i].getId()==e){for(var r=t[i].getChildren(),a=0;a<r.length;a++){var o=r[a].getChildren();n+="<span data-id="+r[a].getId()+">";for(var s=0;s<o.length;s++)n+=o[s].getContent()+" ";n+="</span>"}n.trim();break}return n},e.prototype.getLines=function(){return this._allLines},Object.defineProperty(e.prototype,"pageWidth",{get:function(){return this._pageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageHeight",{get:function(){return this._pageHeight},enumerable:!0,configurable:!0}),e.prototype.detectElementType=function(e){return"string"==e.nodeName.toLowerCase()?AltoElementType.String:"sp"==e.nodeName.toLowerCase()?AltoElementType.SP:"hyp"==e.nodeName.toLowerCase()?AltoElementType.HYP:"textline"==e.nodeName.toLowerCase()?AltoElementType.TextLine:"textblock"==e.nodeName.toLowerCase()?AltoElementType.TextBlock:"composedblock"==e.nodeName.toLowerCase()?AltoElementType.ComposedBlock:"illustration"==e.nodeName.toLowerCase()?AltoElementType.Illustration:"graphicalelement"==e.nodeName.toLowerCase()?AltoElementType.GraphicalElement:null},e}(),g.AltoFile=i}(mycore||(mycore={})),function(e){var t,n,i,r;t=e.viewer||(e.viewer={}),n=t.components||(t.components={}),i=n.events||(n.events={}),r=function(r){function a(e,t,n){var i=r.call(this,e,a.TYPE)||this;return i._href=t,i._onResolve=n,i}return __extends(a,r),a.TYPE="RequestAltoModelEvent",a}(i.MyCoReImageViewerEvent),i.RequestAltoModelEvent=r}(mycore||(mycore={})),function(e){var l,h,t;l=e.viewer||(e.viewer={}),h=l.components||(l.components={}),t=function(n){function s(e){var t=n.call(this)||this;return t._settings=e,t.structureModel=null,t.pageHrefAltoHrefMap=new MyCoReMap,t.altoHrefPageHrefMap=new MyCoReMap,t.altoModelRequestTempStore=new Array,t}return __extends(s,n),s.prototype.init=function(){"mets"==this._settings.doctype&&(this.trigger(new h.events.WaitForEvent(this,h.events.StructureModelLoadedEvent.TYPE)),this.trigger(new h.events.WaitForEvent(this,h.events.RequestAltoModelEvent.TYPE)))},s.prototype.handle=function(e){var r=this;if(e.type==h.events.RequestAltoModelEvent.TYPE&&(null==this.structureModel||this.structureModel._textContentPresent)){var t=e,n=this.detectHrefs(t._href),i=n.altoHref,a=n.imgHref;this.pageHrefAltoHrefMap.has(a)?this.resolveAltoModel(a,function(e){t._onResolve(a,i,e)}):null==this.structureModel&&this.altoModelRequestTempStore.push(t)}if(e.type==h.events.StructureModelLoadedEvent.TYPE){var o=e;if(this.structureModel=o.structureModel,o.structureModel._textContentPresent){for(var s in this.fillAltoHrefMap(),this.altoModelRequestTempStore){t=this.altoModelRequestTempStore[s];var l=this.detectHrefs(t._href);!function(t,n,i){r.pageHrefAltoHrefMap.has(n)?r.resolveAltoModel(n,function(e){i(n,t,e)}):console.warn("RPE : altoHref not found!")}(l.altoHref,l.imgHref,t._onResolve)}this.altoModelRequestTempStore=[],this.trigger(new h.events.WaitForEvent(this,h.events.RequestTextContentEvent.TYPE))}}},s.prototype.detectHrefs=function(e){var t,n;return this.altoHrefPageHrefMap.has(e)?(t=e,n=this.altoHrefPageHrefMap.get(t)):(n=e,t=this.pageHrefAltoHrefMap.get(n)),{altoHref:t,imgHref:n}},s.prototype.fillAltoHrefMap=function(){var n=this;this.structureModel.imageList.forEach(function(e){if(e.additionalHrefs.has(s.TEXT_HREF)){var t=e.additionalHrefs.get(s.TEXT_HREF);n.pageHrefAltoHrefMap.set(e.href,t),n.altoHrefPageHrefMap.set(t,e.href)}})},Object.defineProperty(s.prototype,"handlesEvents",{get:function(){return"mets"==this._settings.doctype?[h.events.RequestAltoModelEvent.TYPE,h.events.StructureModelLoadedEvent.TYPE]:[]},enumerable:!0,configurable:!0}),s.prototype.resolveAltoModel=function(t,n){var i=this,r=this.pageHrefAltoHrefMap.get(t);s.altoHrefModelMap.has(r)?n(s.altoHrefModelMap.get(r)):this.loadAltoXML(this._settings.derivateURL+r,function(e){i.loadedAltoModel(t,r,e,n)},function(e){console.error("Failed to receive alto from server... ",e)})},s.prototype.loadAltoXML=function(e,t,n){var i={url:e,type:"GET",dataType:"xml",async:!0,success:t,error:n};jQuery.ajax(i)},s.prototype.loadedAltoModel=function(e,t,n,i){var r=n.getElementsByTagName("Styles").item(0),a=n.getElementsByTagName("Layout").item(0);if(null!=a){var o=new l.widgets.alto.AltoFile(r,a);s.altoHrefModelMap.set(t,o),i(o)}},s.altoHrefModelMap=new MyCoReMap,s.TEXT_HREF="AltoHref",s}(h.ViewerComponent),h.MyCoReAltoModelProvider=t}(mycore||(mycore={})),addViewerComponent(mycore.viewer.components.MyCoReAltoModelProvider),function(e){var t,n,i,r;t=e.viewer||(e.viewer={}),n=t.widgets||(t.widgets={}),i=n.alto||(n.alto={}),r=function(){function e(){}return e.prototype.generateHtml=function(e,t){var o=this,n=document.createElement("div");n.style.position="absolute",n.style.whiteSpace="nowrap",n.style.fontFamily="sans-serif",n.setAttribute("data-id",t),document.createElement("span");var i=document.createElement("canvas").getContext("2d"),s=.002*e.pageHeight,l=null,r=e.getBlocks().map(function(r){var e=null!==l&&(l.getVPos()+l.getHeight()+s<r.getVPos()||l.getHPos()+l.getWidth()+s<r.getHPos()),t=o.getFontSize(i,r,"sans-serif");t*=.9;var a="<div";return a+=" class='altoBlock'",a+=" style='",a+=" transform: translate("+Math.round(r.getHPos())+"px,"+Math.round(r.getVPos())+"px );",a+=" width: "+r.getWidth()+"px;",a+=" height: "+r.getHeight()+"px;",a+=" font-size: "+t+"px;",e&&(a+=" outline: "+s+"px solid white;"),a+="'>",r.getChildren().map(function(e){var t="<p";t+=" class='altoLine'",t+=" style='height: "+e.getHeight()+"px;",t+=" width: "+e.getWidth()+"px;",t+=" transform: translate("+Math.round(e.getHPos()-r.getHPos())+"px, "+Math.round(e.getVPos()-r.getVPos())+"px);";var n=e.getStyle();if(null!=n){var i=n.getFontStyle();null!=i&&("italic"==i?t+=" font-style: italic;":"bold"==i&&(t+=" font-weight: bold;"))}t+="'>"+o.getLineAsElement(e)+"</p>",a+=t}),l=r,a+="</div>"});return n.innerHTML=r.join(""),n},e.prototype.getWordsArray=function(e){return e.getChildren().filter(function(e){return e.getType()===AltoElementType.String})},e.prototype.getLineAsString=function(e){var t=document.createElement("span");return this.getWordsArray(e).map(function(e){return t.innerText=e.getContent(),t.innerHTML}).join(" ")},e.prototype.getFontSize=function(r,a,o){var s=this,t=function(e,t){var n=s.getLineAsString(e);r.font=function(e){var t=e.getStyle();if(null===t)return"";var n=t.getFontStyle();return null!==n?n+" ":""}(e)+t+"px "+o;var i=a.getWidth()/r.measureText(n).width;return 1<i?t:t*i};if(1===a.getChildren().length){var e=a.getChildren()[0];return t(e,e.getHeight())}var n=a.getChildren().reduce(function(e,t){return Math.max(e,t.getHeight())},0);return a.getChildren().forEach(function(e){n=t(e,n)}),n},e.prototype.getLineAsElement=function(e){var t=document.createElement("word");return this.getWordsArray(e).map(function(e){return t.innerText=e.getContent(),'<span data-vpos="'+e.getVPos()+'"\n                            data-hpos="'+e.getHPos()+'"\n                            data-word="'+e.getContent()+'"\n                            data-width="'+e.getWidth()+'"\n                            data-height="'+e.getHeight()+'"\n                            data-wc="'+e.getWordConfidence()+'"\n                        >'+t.innerHTML+"</span>"}).join(" ")},e}(),i.AltoHTMLGenerator=r}(mycore||(mycore={})),function(r){var a,i,s,o,l,e;a=r.viewer||(r.viewer={}),i=a.components||(a.components={}),s=r.viewer.components.events.RequestAltoModelEvent,o=r.viewer.widgets.alto.AltoHTMLGenerator,l=r.viewer.components.events.PageLoadedEvent,e=function(n){function e(e){var t=n.call(this)||this;return t.settings=e,t.vImageInformationMap=new MyCoReMap,t.vImagePageMap=new MyCoReMap,t.vAltoHTMLGenerator=new o,t.vImageHTMLMap=new MyCoReMap,t.vImageCallbackMap=new MyCoReMap,t}return __extends(e,n),e.prototype.init=function(){"mets"===this.settings.doctype&&this.trigger(new i.events.WaitForEvent(this,i.events.RequestPageEvent.TYPE))},e.prototype.getPage=function(a,e){var o=this;if(this.vImagePageMap.has(a))e(this.vImagePageMap.get(a));else if(this.vImageCallbackMap.has(a))this.vImageCallbackMap.get(a).push(e);else{var t=[];t.push(e),this.vImageCallbackMap.set(a,t),this.getPageMetadata(a,function(e){var r=o.createPageFromMetadata(a,e);o.vImageHTMLMap.has(a)||o.trigger(new s(o,a,function(e,t,n){if(!o.vImageHTMLMap.has(a)){var i=o.vAltoHTMLGenerator.generateHtml(n,t);r.getHTMLContent().value=i,o.vImageHTMLMap.set(a,i)}}));for(var t,n=o.vImageCallbackMap.get(a);t=n.pop();)t(r);o.vImagePageMap.set(a,r),o.trigger(new l(o,a,r))})}},e.prototype.createPageFromMetadata=function(e,t){var n=this,i=this.settings.tileProviderPath.split(","),r=new Array;return i.forEach(function(e){r.push(e+n.settings.derivate+t.path+"/{z}/{y}/{x}.jpg")}),new a.widgets.canvas.TileImagePage(e,t.width,t.height,r)},e.prototype.getPageMetadata=function(t,n){var i=this;if(t="/"===t.charAt(0)?t.substr(1):t,this.vImageInformationMap.has(t))n(this.vImageInformationMap.get(t));else{var e="/"+t;r.viewer.widgets.image.XMLImageInformationProvider.getInformation(this.settings.imageXmlPath+this.settings.derivate,e,function(e){i.vImageInformationMap.set(t,e),n(e)},function(e){console.log("Error while loading ImageInformations",+e.toString())})}},Object.defineProperty(e.prototype,"handlesEvents",{get:function(){return"mets"===this.settings.doctype?[i.events.RequestPageEvent.TYPE]:[]},enumerable:!0,configurable:!0}),e.prototype.handle=function(e){if(e.type===i.events.RequestPageEvent.TYPE){var t=e;this.getPage(t._pageId,function(e){t._onResolve(t._pageId,e)})}},e}(i.ViewerComponent),i.MyCoReMetsPageProviderComponent=e}(mycore||(mycore={})),addViewerComponent(mycore.viewer.components.MyCoReMetsPageProviderComponent),function(e){var t,n,i,r;t=e.viewer||(e.viewer={}),n=t.widgets||(t.widgets={}),i=n.modal||(n.modal={}),r=function(n){function r(e){var t=n.call(this,e,"CreatePDF")||this;return t.checkEventHandler=null,t.rangeInputEventHandler=null,t.chapterInputEventHandler=null,t.okayClickHandler=null,t._inputRow=jQuery("<div></div>"),t._inputRow.addClass("row"),t._inputRow.appendTo(t.modalBody),t._previewBox=jQuery("<div></div>"),t._previewBox.addClass("printPreview"),t._previewBox.addClass("col-sm-12"),t._previewBox.appendTo(t._inputRow),t._previewImage=jQuery("<img />"),t._previewImage.addClass("img-thumbnail mx-auto d-block"),t._previewImage.appendTo(t._previewBox),t._pageSelectBox=jQuery("<form></form>"),t._pageSelectBox.addClass("printForm"),t._pageSelectBox.addClass("col-sm-12"),t._pageSelectBox.appendTo(t._inputRow),t._selectGroup=jQuery("<div></div>"),t._selectGroup.addClass("form-group"),t._selectGroup.appendTo(t._pageSelectBox),t._createRadioAllPages(),t._createRadioCurrentPage(),t._createRadioRangePages(),t._createRadioChapters(),t._validationRow=jQuery("<div></div>"),t._validationRow.addClass("row"),t._validationRow.appendTo(t.modalBody),t._validationMessage=jQuery("<p></p>"),t._validationMessage.addClass("col-sm-12"),t._validationMessage.addClass("pull-right"),t._validationMessage.appendTo(t._validationRow),t._okayButton=jQuery("<a>OK</a>"),t._okayButton.attr("type","button"),t._okayButton.addClass("btn btn-secondary"),t._okayButton.appendTo(t.modalFooter),t._maximalPageMessage=jQuery('<div class="row"><span class="col-sm-12 message"></span></div>'),t._maximalPageMessage.appendTo(t.modalBody),t._maximalPageNumber=jQuery("<span></span>"),t._maximalPageNumber.text(""),t._maximalPageMessage.children().append(t._maximalPageNumber),t._okayButton.click(function(){null!=t.okayClickHandler&&t.okayClickHandler()}),t}return __extends(r,n),Object.defineProperty(r.prototype,"currentPageLabel",{get:function(){return this._radioCurrentPageLabelElement.text()},set:function(e){this._radioCurrentPageLabelElement.text(e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"allPagesLabel",{get:function(){return this._radioAllPagesLabelElement.text()},set:function(e){this._radioAllPagesLabelElement.text(e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rangeChecked",{get:function(){return this._radioRangePagesInput.prop("checked")},set:function(e){this._radioRangePagesInput.prop("checked",e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"allChecked",{get:function(){return this._radioAllPagesInput.prop("checked")},set:function(e){this._radioAllPagesInput.prop("checked",e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentChecked",{get:function(){return this._radioCurrentPageInput.prop("checked")},set:function(e){this._radioCurrentPageInput.prop("checked",e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"chapterChecked",{get:function(){return this._radioChapterInput.prop("checked")},set:function(e){this._radioChapterInput.prop("checked",e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"validationResult",{set:function(e){e?(this._validationMessage.removeClass("text-danger"),this._validationMessage.addClass("text-success"),this._okayButton.removeClass("disabled")):(this._validationMessage.removeClass("text-success"),this._validationMessage.addClass("text-danger"),this._okayButton.addClass("disabled"))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"validationMessage",{get:function(){return this._validationMessage.text()},set:function(e){this._validationMessage.text(e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rangeLabel",{get:function(){return this._radioRangePagesLabelElement.text()},set:function(e){this._radioRangePagesLabelElement.text(e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"chapterLabel",{get:function(){return this._chapterLabelElement.text()},set:function(e){this._chapterLabelElement.text(e)},enumerable:!0,configurable:!0}),r.prototype._createRadioRangePages=function(){var e=this,t=r.INPUT_IDENTIFIER+"_radio_range";this._radioRangePages=jQuery("<div></div>"),this._radioRangePages.addClass("form-check"),this._radioRangePagesLabelElement=jQuery("<label></label>"),this._radioRangePagesLabelElement.addClass("form-check-label"),this._radioRangePagesLabelElement.attr("for",t),this._radioRangePagesInput=jQuery("<input>"),this._radioRangePagesInput.addClass("form-check-input"),this._radioRangePagesInput.attr("type","radio"),this._radioRangePagesInput.attr("name",r.INPUT_IDENTIFIER),this._radioRangePagesInput.attr("id",t),this._radioRangePagesInput.attr("value",r.INPUT_RANGE_VALUE),this._radioRangePagesInputText=jQuery("<input>"),this._radioRangePagesInputText.addClass("form-control"),this._radioRangePagesInputText.attr("type","text"),this._radioRangePagesInputText.attr("name",r.INPUT_RANGE_TEXT_IDENTIFIER),this._radioRangePagesInputText.attr("id",r.INPUT_RANGE_TEXT_IDENTIFIER),this._radioRangePagesInputText.attr("placeholder","1,3-5,8");var n=this,i=function(){null!=n.checkEventHandler&&n.checkEventHandler(r.INPUT_RANGE_VALUE),e._radioRangePagesInputText.focus()};this._radioRangePagesInput.change(i),this._radioRangePagesInput.click(i),this._radioRangePagesInputText.click(function(){e.allChecked=!1,e.currentChecked=!1,e.rangeChecked=!0,i(),e._radioRangePagesInputText.focus()}),this._radioRangePagesInputText.keyup(function(){null!=n.rangeInputEventHandler&&e.rangeInputEventHandler(e._radioRangePagesInputText.val())}),this._radioRangePages.append(this._radioRangePagesInput),this._radioRangePages.append(this._radioRangePagesLabelElement),this._radioRangePages.append(this._radioRangePagesInputText),this._radioRangePages.appendTo(this._selectGroup)},r.prototype._createRadioChapters=function(){var e=this,t=r.INPUT_IDENTIFIER+"_radio_chapter";this._radioChapter=jQuery("<div></div>"),this._radioChapter.addClass("form-check"),this._radioChapterInput=jQuery("<input>"),this._radioChapterInput.addClass("form-check-input"),this._radioChapterInput.attr("type","radio"),this._radioChapterInput.attr("name",r.INPUT_IDENTIFIER),this._radioChapterInput.attr("id",t),this._radioChapterInput.attr("value",r.INPUT_CHAPTER_VALUE),this._chapterLabelElement=jQuery("<label></label>"),this._chapterLabelElement.addClass("form-check-label"),this._chapterLabelElement.attr("for",t),this._chapterSelect=jQuery("<select></select>"),this._chapterSelect.addClass("form-control"),this._radioChapter.append(this._radioChapterInput),this._radioChapter.append(this._chapterLabelElement),this._radioChapter.append(this._chapterSelect),this._radioChapter.appendTo(this._selectGroup);var n=function(){null!=e.checkEventHandler&&e.checkEventHandler(r.INPUT_CHAPTER_VALUE)};this._radioChapterInput.change(n),this._chapterSelect.change(function(){n(),e.chapterChecked=!0,null!=e.chapterInputEventHandler&&e.chapterInputEventHandler(e._chapterSelect.val())})},Object.defineProperty(r.prototype,"previewImageSrc",{get:function(){return this._previewImage.attr("src")},set:function(e){this._previewImage.attr("src",e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rangeInputVal",{get:function(){return this._radioRangePagesInputText.val()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rangeInputEnabled",{get:function(){return"true"===this._radioRangePagesInputText.attr("enabled")},set:function(e){this._radioRangePagesInputText.val(""),this._radioRangePagesInputText.attr("enabled",e)},enumerable:!0,configurable:!0}),r.prototype._createRadioAllPages=function(){var e=this,t=r.INPUT_IDENTIFIER+"_radio_all";this._radioAllPages=jQuery("<div></div>"),this._radioAllPages.addClass("form-check"),this._radioAllPagesLabelElement=jQuery("<label></label>"),this._radioAllPagesLabelElement.addClass("form-check-label"),this._radioAllPagesLabelElement.attr("for",t),this._radioAllPagesInput=jQuery("<input>"),this._radioAllPagesInput.attr("type","radio"),this._radioAllPagesInput.attr("name",r.INPUT_IDENTIFIER),this._radioAllPagesInput.attr("id",t),this._radioAllPagesInput.attr("value",r.INPUT_ALL_VALUE),this._radioAllPagesInput.addClass("form-check-input"),this._radioAllPagesInput.change(function(){null!=e.checkEventHandler&&e.checkEventHandler(r.INPUT_ALL_VALUE)}),this._radioAllPages.append(this._radioAllPagesInput),this._radioAllPages.append(this._radioAllPagesLabelElement),this._radioAllPages.appendTo(this._selectGroup)},r.prototype._createRadioCurrentPage=function(){var e=this,t=r.INPUT_IDENTIFIER+"_radio_current";this._radioCurrentPage=jQuery("<div></div>"),this._radioCurrentPage.addClass("form-check"),this._radioCurrentPageLabelElement=jQuery("<label></label>"),this._radioCurrentPageLabelElement.addClass("form-check-label"),this._radioCurrentPageLabelElement.attr("for",t),this._radioCurrentPageInput=jQuery("<input>"),this._radioCurrentPageInput.addClass("form-check-input"),this._radioCurrentPageInput.attr("type","radio"),this._radioCurrentPageInput.attr("name",r.INPUT_IDENTIFIER),this._radioCurrentPageInput.attr("id",t),this._radioCurrentPageInput.attr("value",r.INPUT_CURRENT_VALUE),this._radioCurrentPageInput.change(function(){null!=e.checkEventHandler&&e.checkEventHandler(r.INPUT_CURRENT_VALUE)}),this._radioCurrentPage.append(this._radioCurrentPageInput),this._radioCurrentPage.append(this._radioCurrentPageLabelElement),this._radioCurrentPage.appendTo(this._selectGroup)},Object.defineProperty(r.prototype,"maximalPages",{set:function(e){this._maximalPageNumber.text(e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maximalPageMessage",{set:function(e){this._maximalPageNumber.detach();var t=this._maximalPageMessage.find(".message");t.text(e+" "),t.append(this._maximalPageNumber)},enumerable:!0,configurable:!0}),r.prototype.setChapterTree=function(e){this._chapterSelect.html(e.map(function(e){return"<option value='"+e.id+"'>"+e.label+"</option>"}).join(""))},Object.defineProperty(r.prototype,"chapterInputVal",{get:function(){return this._chapterSelect.val()},enumerable:!0,configurable:!0}),r.INPUT_IDENTIFIER="pages",r.INPUT_RANGE_TEXT_IDENTIFIER=(r.INPUT_RANGE_IDENTIFIER="range")+"-text",r.INPUT_CHAPTER_VALUE="chapter",r.INPUT_ALL_VALUE="all",r.INPUT_RANGE_VALUE="range",r.INPUT_CURRENT_VALUE="current",r}(i.IviewModalWindow),i.ViewerPrintModalWindow=r}(mycore||(mycore={})),function(t){var o,s,e;o=t.viewer||(t.viewer={}),s=o.components||(o.components={}),e=function(n){function e(e){var t=n.call(this)||this;return t._settings=e,t._enabled=null!=t._settings.pdfCreatorStyle&&0!=t._settings.pdfCreatorStyle.length||t._settings.pdfCreatorURI,t}return __extends(e,n),Object.defineProperty(e.prototype,"handlesEvents",{get:function(){return"mets"==this._settings.doctype&&this._enabled?[o.widgets.toolbar.events.ButtonPressedEvent.TYPE,s.events.LanguageModelLoadedEvent.TYPE,s.events.StructureModelLoadedEvent.TYPE,s.events.ImageChangedEvent.TYPE,s.events.ProvideToolbarModelEvent.TYPE]:[]},enumerable:!0,configurable:!0}),e.prototype.init=function(){"mets"==this._settings.doctype&&this._enabled&&(this._resolveMaxRequests(),this.initModalWindow(),this.trigger(new s.events.WaitForEvent(this,s.events.LanguageModelLoadedEvent.TYPE)),this.trigger(new s.events.WaitForEvent(this,s.events.StructureModelLoadedEvent.TYPE)),this.trigger(new s.events.WaitForEvent(this,s.events.ProvideToolbarModelEvent.TYPE)),this.trigger(new s.events.ComponentInitializedEvent(this)))},e.prototype.handle=function(e){var t=this;if(e.type==s.events.ProvideToolbarModelEvent.TYPE){var n=e;this._printButton=new o.widgets.toolbar.ToolbarButton("PrintButton","PDF","",""),this._printButton.icon="file-pdf",this._printButton.label="","MyCoReFrameToolbar"==n.model.name?n.model._zoomControllGroup.addComponent(this._printButton):n.model._actionControllGroup.addComponent(this._printButton)}if(e.type==s.events.LanguageModelLoadedEvent.TYPE){var i=e.languageModel;this._printButton.tooltip=i.getTranslation("toolbar.pdf"),this._modalWindow.closeLabel=i.getTranslation("createPdf.cancel"),this._modalWindow.currentPageLabel=i.getTranslation("createPdf.range.currentPage"),this._modalWindow.allPagesLabel=i.getTranslation("createPdf.range.allPages"),this._modalWindow.rangeLabel=i.getTranslation("createPdf.range.manual"),this._modalWindow.chapterLabel=i.getTranslation("createPdf.range.chapter"),this._modalWindow.title=i.getTranslation("createPdf.title"),this._languageModel=i,this._modalWindow.maximalPageMessage=i.getTranslation("createPdf.maximalPages")}if(e.type==o.widgets.toolbar.events.ButtonPressedEvent.TYPE&&"PrintButton"==e.button.id&&("pdf"==this._settings.doctype?window.location.href=this._settings.metsURL:this._modalWindow.show()),e.type==s.events.StructureModelLoadedEvent.TYPE){var r=e;this._structureModel=r.structureModel,this._modalWindow.setChapterTree(this.getChapterViewModel())}if(e.type==s.events.ImageChangedEvent.TYPE){var a=e;this._currentImage=a.image,this._modalWindow.currentChecked&&void 0!==this._currentImage&&this._currentImage.requestImgdataUrl(function(e){t._modalWindow.previewImageSrc=e})}},e.prototype.getChapterViewModel=function(e,t){void 0===e&&(e=this._structureModel.rootChapter),void 0===t&&(t=0);for(var n=[],i="",r=0;r<t;r++)i+="&nbsp;&nbsp;";var a=i+e.label,o=25+i.length;a.length>o&&(a=a.substr(0,o)+"..."),n.push({id:e.id,label:a});for(var s=t+1,l=0,h=e.chapter;l<h.length;l++){var d=h[l];n.push.apply(n,this.getChapterViewModel(d,s))}return n},e.prototype.initModalWindow=function(){var n=this;this._modalWindow=new t.viewer.widgets.modal.ViewerPrintModalWindow(this._settings.mobile),this._modalWindow.checkEventHandler=function(e){"range"==e?n.handleRangeChecked():"chapter"==e?n.handleChapterChecked():(n._modalWindow.rangeInputEventHandler=null,n._modalWindow.chapterInputEventHandler=null,n._modalWindow.rangeInputEnabled=!1,"all"==e?n.handleAllChecked():"current"==e&&n.handleCurrentChecked())},this._modalWindow.okayClickHandler=function(){var e;if(n._modalWindow.currentChecked&&(e=n._currentImage.order),n._modalWindow.allChecked&&(e="1-"+n._structureModel._imageList.length),n._modalWindow.rangeChecked&&(e=n._modalWindow.rangeInputVal),n._modalWindow.chapterChecked){var t=n.findChapterWithID(n._modalWindow.chapterInputVal);e=n.getRangeOfChapter(t)}window.location.href=n.buildPDFRequestLink(e)},this._modalWindow.currentChecked=!0},e.prototype.handleChapterChecked=function(){var r=this;this._modalWindow.rangeInputEnabled=!1,this._modalWindow.validationMessage="",this._modalWindow.previewImageSrc=null,this._modalWindow.chapterInputEventHandler=function(e){var t=r.findChapterWithID(e),n=r.getRangeOfChapter(t),i=r.validateRange(n);i.valid?(r._modalWindow.validationMessage="",r._modalWindow.validationResult=!0,r._structureModel.imageList[i.firstPage].requestImgdataUrl(function(e){r._modalWindow.previewImageSrc=e})):(r._modalWindow.validationMessage=i.text,r._modalWindow.validationResult=i.valid,r._modalWindow.previewImageSrc=null)},this._modalWindow.chapterInputEventHandler(this._modalWindow.chapterInputVal)},e.prototype.handleCurrentChecked=function(){var t=this;this._modalWindow.validationMessage="",this._currentImage.requestImgdataUrl(function(e){t._modalWindow.previewImageSrc=e}),this._modalWindow.validationResult=!0},e.prototype.handleAllChecked=function(){var t=this,e=this._structureModel.imageList.length+1;this._maxPages<e?(this._modalWindow.validationMessage=this._languageModel.getTranslation("createPdf.errors.tooManyPages"),this._modalWindow.validationResult=!1,this._modalWindow.previewImageSrc=null):(this._modalWindow.validationResult=!0,this._structureModel.imageList[0].requestImgdataUrl(function(e){t._modalWindow.previewImageSrc=e}))},e.prototype.handleRangeChecked=function(){var n=this;this._modalWindow.rangeInputEnabled=!0,this._modalWindow.validationMessage="",this._modalWindow.previewImageSrc=null,this._modalWindow.rangeInputEventHandler=function(e){var t=n.validateRange(e);t.valid?(n._modalWindow.validationMessage="",n._modalWindow.validationResult=!0,n._structureModel.imageList[t.firstPage].requestImgdataUrl(function(e){n._modalWindow.previewImageSrc=e})):(n._modalWindow.validationMessage=t.text,n._modalWindow.validationResult=t.valid,n._modalWindow.previewImageSrc=null)}},e.prototype.buildPDFRequestLink=function(e){var t=encodeURIComponent(ViewerFormatString("{metsURL}/mets.xml?XSL.Style={pdfCreatorStyle}",this._settings));return this._settings.metsLocation=t,this._settings.pages=e,ViewerFormatString(this._settings.pdfCreatorFormatString||"{pdfCreatorURI}?mets={metsLocation}&pages={pages}",this._settings)},e.prototype.buildRestrictionLink=function(){return ViewerFormatString(this._settings.pdfCreatorRestrictionFormatString||"{pdfCreatorURI}?getRestrictions",this._settings)},e.prototype._resolveMaxRequests=function(){var t=this;jQuery.ajax({type:"GET",dataType:"json",url:this.buildRestrictionLink(),crossDomain:!0,complete:function(e,t){},success:function(e){t._maxPages=parseInt(e.maxPages),t._modalWindow.maximalPages=t._maxPages.toString()}})},e.prototype.findChapterWithID=function(e,t){if(void 0===t&&(t=this._structureModel.rootChapter),t.id==e)return t;for(var n=0,i=t.chapter;n<i.length;n++){var r=i[n],a=this.findChapterWithID(e,r);if(null!=a)return a}return null},e.prototype.validateRange=function(e){var t=e.split(","),n=99999;if(0==e.length)return{valid:!1,text:this._languageModel.getTranslation("createPdf.errors.noPages")};for(var i=0,r=this._maxPages,a=0,o=t;a<o.length;a++){var s=o[a];if(-1==s.indexOf("-")){if(!this.isValidPage(s))return{valid:!1,text:this._languageModel.getTranslation("createPdf.errors.rangeInvalid")};var l=parseInt(s);l<n&&(n=l),i++}else{var h=s.split("-");if(2!=h.length)return{valid:!1,text:this._languageModel.getTranslation("createPdf.errors.rangeInvalid")};var d=h[0],u=h[1];if(!this.isValidPage(d))return{valid:!1,text:ViewerFormatString(this._languageModel.getTranslation("createPdf.errors.rangeInvalid"),{0:d})};if(!this.isValidPage(u))return{valid:!1,text:ViewerFormatString(this._languageModel.getTranslation("createPdf.errors.rangeInvalid"),{0:u})};var g=parseInt(d),p=parseInt(u);if(p<=g)return{valid:!1,text:this._languageModel.getTranslation("createPdf.errors.rangeInvalid")};if(r<(i+=p-g))return{valid:!1,text:ViewerFormatString(this._languageModel.getTranslation("createPdf.errors.tooManyPages"),{0:r.toString()})};g<n&&(n=g)}}return{valid:!0,text:"",firstPage:n-1}},e.prototype.isValidPage=function(e){return void 0!==this._structureModel._imageList[parseInt(e)-1]&&!isNaN(e)},e.prototype.getRangeOfChapter=function(e){for(var t=this._structureModel._imageToChapterMap,n=[],i=function(e,t){return e==t||null!=t.parent&&i(e,t.parent)},r=null,a=null,o=0,s=this._structureModel.imageList;o<s.length;o++){var l=s[o];if(t.has(l.id)){var h=t.get(l.id);if(i(e,h)){null==r?r=l:a=l;continue}}null!=r&&null!=a?n.push(r.order+"-"+a.order):null!=r&&n.push(r.order+""),r=a=null}return null!=r&&null!=a?n.push(r.order+1+"-"+(a.order+1)):null!=r&&n.push(r.order+1+""),n.join(",")},e}(s.ViewerComponent),s.MyCoRePrintComponent=e}(mycore||(mycore={})),addViewerComponent(mycore.viewer.components.MyCoRePrintComponent),function(e){var t,n,i,r;t=e.viewer||(e.viewer={}),n=t.widgets||(t.widgets={}),i=n.canvas||(n.canvas={}),r=function(){function e(){this.selectedChapter=null,this.highlightedChapter=null,this.fadeAnimation=null,this.chaptersToClear=new MyCoReMap,this.enabled=!0}return e.prototype.isEnabled=function(){return this.enabled},e.prototype.setEnabled=function(e){this.enabled=e},e.prototype.draw=function(e,t,n,i){if(void 0===i&&(i=!1),this.isEnabled()){var r=this.isChapterSelected(),a=this.isHighlighted(),o=null!=this.fadeAnimation&&this.fadeAnimation.isRunning;if(o||r||a||this.chaptersToClear.clear(),r&&this.chaptersToClear.set("selected",this.selectedChapter),a?this.chaptersToClear.set("highlighted",this.highlightedChapter):r&&this.chaptersToClear.remove("highlighted"),o||r||a){var s=r?"rgba(0,0,0,0.4)":"rgba(0,0,0,0.15)";null!=this.fadeAnimation&&(s="rgba(0,0,0,"+this.fadeAnimation.value+")"),this.isLinkedWithoutBlocks(t)||this.darkenPage(e,n,s),this.clearRects(e,t)}a&&r&&this.drawRects(e,t,this.highlightedChapter.boundingBoxMap,"rgba(0,0,0,0.2)")}},e.prototype.isChapterSelected=function(){return null!=this.selectedChapter&&!this.selectedChapter.boundingBoxMap.isEmpty()},e.prototype.isHighlighted=function(){var e=null!=this.highlightedChapter&&!this.highlightedChapter.boundingBoxMap.isEmpty();return e&&this.isChapterSelected()?this.highlightedChapter.chapterId!==this.selectedChapter.chapterId:e},e.prototype.isLinkedWithoutBlocks=function(i){return!this.chaptersToClear.filter(function(e,t){var n=t.boundingBoxMap.get(i);return null!=n&&0===n.length}).isEmpty()},e.prototype.darkenPage=function(e,t,n){e.save(),e.strokeStyle=n,e.fillStyle=n,e.beginPath(),e.rect(0,0,t.width,t.height),e.closePath(),e.fill(),e.restore()},e.prototype.clearRects=function(t,n){t.save(),this.chaptersToClear.values.forEach(function(e){e.boundingBoxMap.hasThen(n,function(e){e.forEach(function(e){t.clearRect(e.getX(),e.getY(),e.getWidth(),e.getHeight())})})}),t.restore()},e.prototype.drawRects=function(t,e,n,i){t.save(),t.strokeStyle=i,t.fillStyle=i,t.beginPath(),n.hasThen(e,function(e){e.forEach(function(e){t.rect(e.getX(),e.getY(),e.getWidth(),e.getHeight())})}),t.closePath(),t.fill(),t.restore()},e}(),i.HighlightAltoChapterCanvasPageLayer=r}(mycore||(mycore={})),function(e){var r;(function(o){var s=o.events.RequestAltoModelEvent,t=o.events.WaitForEvent,e=function(i){function e(e,t){var n=i.call(this)||this;return n._settings=e,n.container=t,n.pageLayout=null,n.highlightLayer=new r.widgets.canvas.HighlightAltoChapterCanvasPageLayer,n._altoChapterContainer=null,n.selectedChapter=null,n.highlightedChapter=null,n}return __extends(e,i),e.prototype.init=function(){"mets"===this._settings.doctype&&(this.trigger(new t(this,o.events.PageLayoutChangedEvent.TYPE)),this.trigger(new t(this,o.events.RequestPageEvent.TYPE)),this.trigger(new o.events.AddCanvasPageLayerEvent(this,0,this.highlightLayer)))},Object.defineProperty(e.prototype,"handlesEvents",{get:function(){return"mets"===this._settings.doctype?[o.events.ChapterChangedEvent.TYPE,o.events.PageLayoutChangedEvent.TYPE,o.events.RequestPageEvent.TYPE,o.events.MetsLoadedEvent.TYPE,o.events.TextEditEvent.TYPE]:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return null!=this._model&&this._model._textContentPresent},enumerable:!0,configurable:!0}),e.prototype.getPageLayout=function(){return this.pageLayout},e.prototype.getPageController=function(){return this.pageLayout.getPageController()},e.prototype.getAltoChapterContainer=function(){return this._altoChapterContainer},e.prototype.setChapter=function(e,t,n){if(void 0===t&&(t=!1),void 0===n&&(n=!1),(n||this.selectedChapter!==e)&&(this.selectedChapter=e,null!==this._altoChapterContainer&&this._altoChapterContainer.hasLoadedPages()&&(this.highlightLayer.selectedChapter=null!=e?this._altoChapterContainer.chapters.get(e):null,this.handleDarkenPageAnimation(),this.trigger(new o.events.RedrawEvent(this)),t))){var i=this._altoChapterContainer.getChapter(e);this.trigger(new o.events.ChapterChangedEvent(this,i))}},e.prototype.setHighlightChapter=function(e){null!==this._altoChapterContainer&&this._altoChapterContainer.hasLoadedPages()&&this.highlightedChapter!==e&&(this.highlightLayer.highlightedChapter=null!=e?this._altoChapterContainer.chapters.get(e):null,this.highlightedChapter=e,null==this.selectedChapter&&this.handleDarkenPageAnimation(),this.trigger(new o.events.RedrawEvent(this)))},e.prototype.handleDarkenPageAnimation=function(){var e=null!=this.selectedChapter,t=null!=this.highlightedChapter,n=0;if(null!=this.highlightLayer.fadeAnimation&&(n=this.highlightLayer.fadeAnimation.value,this.getPageController().removeAnimation(this.highlightLayer.fadeAnimation)),!e&&!t){if(0===n)return;return this.highlightLayer.fadeAnimation=new r.widgets.canvas.InterpolationAnimation(1e3,n,0),void this.getPageController().addAnimation(this.highlightLayer.fadeAnimation)}var i=e?.4:.15;this.highlightLayer.fadeAnimation=new r.widgets.canvas.InterpolationAnimation(1e3,n,i),this.getPageController().addAnimation(this.highlightLayer.fadeAnimation)},e.prototype.handle=function(e){var i=this;if(e.type===o.events.MetsLoadedEvent.TYPE){var t=e;if(this._model=t.mets.model,!this.isEnabled)return;this._altoChapterContainer=new h(this._model),null!=this.selectedChapter&&this.setChapter(this.selectedChapter,!1,!0),this.trigger(new o.events.RequestDesktopInputEvent(this,new l(this)))}if(e.type===o.events.RequestPageEvent.TYPE){var r=e;this.trigger(new s(this,r._pageId,function(e,t,n){i._altoChapterContainer.addPage(r._pageId,t,n),null!=i.selectedChapter&&i.setChapter(i.selectedChapter,!1,!0)}))}if(e.type===o.events.ChapterChangedEvent.TYPE){var n=e;if(null==n||null==n.chapter)return;this.setChapter(n.chapter.id)}if(e.type===o.events.PageLayoutChangedEvent.TYPE&&(this.pageLayout=e.pageLayout),e.type===o.events.TextEditEvent.TYPE){var a=e;this.highlightLayer.setEnabled(!a.edit)}},e}(o.ViewerComponent);o.MyCoReHighlightAltoComponent=e;var l=function(n){function e(e){var t=n.call(this)||this;return t.component=e,t}return __extends(e,n),e.prototype.mouseClick=function(e){var t=this.getChapterId(e);this.component.setChapter(t,!0)},e.prototype.mouseMove=function(e){var t=this.getChapterId(e);this.component.setHighlightChapter(t)},e.prototype.getChapterId=function(e){var t=this.component.getPageLayout();if(null==t)return null;var n=t.getPageHitInfo(e);if(null==n.id)return null;var i=this.component.getAltoChapterContainer();if(null===i)return null;var r=i.chapters,a=i.pageChapterMap.get(n.id);if(null==a||a.length<=0)return null;for(var o=0,s=a;o<s.length;o++){var l=s[o],h=r.get(l).boundingBoxMap.get(n.id);if(null!=h)for(var d=0,u=h;d<u.length;d++)if(u[d].scale(n.pageAreaInformation.scale).intersects(n.hit))return l}return null},e}(r.widgets.canvas.DesktopInputAdapter),h=function(){function e(e){var a=this;this._model=e,this.chapters=new MyCoReMap,this.pageChapterMap=new MyCoReMap,this.loadedPages={},this._model.smLinkMap.forEach(function(e,t){a.chapters.set(e,new d(e));for(var n=0,i=t;n<i.length;n++){var r=i[n];a.pageChapterMap.has(r)||a.pageChapterMap.set(r,[]),a.pageChapterMap.get(r).push(e)}})}return e.prototype.hasLoadedPages=function(){return 0<Object.keys(this.loadedPages).length},e.prototype.getAreaListOfChapter=function(e){var t=e.additional.get("blocklist");return null==t?[]:t.map(function(e){return new n(e.fileId,e.fromId,e.toId)})},e.prototype.getChapter=function(e){return this.findChapter(this._model.rootChapter,e)},e.prototype.findChapter=function(e,t){if(e.id===t)return e;for(var n=0,i=e.chapter;n<i.length;n++){var r=i[n],a=this.findChapter(r,t);if(null!=a)return a}return null},e.prototype.getBlocklistOfChapterAndAltoHref=function(e,t){var n=this.getChapter(e);return null==n?[]:this.getAreaListOfChapter(n).filter(function(e){return t===e.altoRef})},e.prototype.getAllBlocklistChapters=function(e){var t=this,n=[];return null!=e.additional.get("blocklist")&&n.push(e),e.chapter.forEach(function(e){n=n.concat(t.getAllBlocklistChapters(e))}),n},e.prototype.addPage=function(s,t,l){var n=this;null==this.loadedPages[s]&&(this.loadedPages[s]=!0,this.pageChapterMap.hasThen(s,function(e){e.map(function(e){return n.chapters.get(e)}).forEach(function(e){e.addPage(s,l,n.getBlocklistOfChapterAndAltoHref(e.chapterId,t))}),e.map(function(e){return n.chapters.get(e)}).forEach(function(e,t,n){var i=e.maximize(s);if(null!=i){e.boundingBoxMap.set(s,[i]);for(var r=0;r<n.length;r++)if(t!==r){var a=n[r].maximize(s);e.fixBoundingBox(s,a),e.fixIntersections(s,n[r])}var o=e.altoRectMap.get(s);e.cutVerticalBoundingBox(s,o[0].getY()),e.cutVerticalBoundingBox(s,o[o.length-1].getY()+o[o.length-1].getHeight()),e.fixEmptyAreas(s,l)}})}))},e}();o.AltoChapterContainer=h;var d=function(){function e(e){this.chapterId=e,this.boundingBoxMap=new MyCoReMap,this.altoRectMap=new MyCoReMap,this.metsAreas=new MyCoReMap}return e.prototype.addPage=function(e,t,n){var i=this.getAltoBlocks(t,n),r=this.getAreaRects(t,i);this.altoRectMap.set(e,r),this.boundingBoxMap.set(e,r),this.metsAreas.set(e,n)},e.prototype.maximize=function(e){var t=this.boundingBoxMap.get(e);return null==t||0===t.length?null:t.reduce(function(e,t){return e.maximizeRect(t)})},e.prototype.fixBoundingBox=function(e,n){if(null!=n&&!this.intersectsText(e,n))for(var i=this.boundingBoxMap.get(e),t=function(t){return t.intersectsArea(n)?(i=i.filter(function(e){return e!==t}),t.difference(n).forEach(function(e){return i.push(e)}),r.boundingBoxMap.set(e,i),r.fixBoundingBox(e,n),{value:void 0}):"continue"},r=this,a=0,o=i;a<o.length;a++){var s=t(o[a]);if("object"==typeof s)return s.value}},e.prototype.intersectsText=function(e,t){for(var n=0,i=this.altoRectMap.get(e);n<i.length;n++)if(i[n].intersectsArea(t))return!0;return!1},e.prototype.fixIntersections=function(r,a){for(var o=this.boundingBoxMap.get(r),s=a.boundingBoxMap.get(r),e=function(t){for(var e=0,n=s;e<n.length;e++){var i=n[e];if(t.intersectsArea(i))return o=o.filter(function(e){return e!==t}),t.difference(i).forEach(function(e){return o.push(e)}),l.boundingBoxMap.set(r,o),l.fixIntersections(r,a),{value:void 0}}},l=this,t=0,n=o;t<n.length;t++){var i=e(n[t]);if("object"==typeof i)return i.value}},e.prototype.cutVerticalBoundingBox=function(n,i){for(var r=this.boundingBoxMap.get(n),e=function(t){if(!t.intersectsVertical(i))return"continue";r=r.filter(function(e){return e!==t});var e=i-t.getY();r.push(Rect.fromXYWH(t.getX(),t.getY(),t.getWidth(),e)),r.push(Rect.fromXYWH(t.getX(),t.getY()+e+1,t.getWidth(),t.getHeight()-(e+1))),a.boundingBoxMap.set(n,r)},a=this,t=0,o=r;t<o.length;t++)e(o[t])},e.prototype.fixEmptyAreas=function(e,t){var n=this.boundingBoxMap.get(e),i=this.metsAreas.get(e),r=t.allElements.map(function(e){return e.getId()}),a=t.allElements.filter(function(t){return i.some(function(e){return e.contains(r,t.getId())})}).map(function(e){return e.asRect()});n=n.filter(function(e){for(var t=0,n=a;t<n.length;t++){var i=n[t];if(e.intersectsArea(i))return!0}return!1}),this.boundingBoxMap.set(e,n)},e.prototype.getAltoBlocks=function(e,t){var a=e.allElements,n=a.map(function(e){return e.getId()}),o=[];return t.map(function(e){return[n.indexOf(e.begin),n.indexOf(e.end)]}).forEach(function(e){for(var t=e[0],n=e[1],i=t;i<=n;i++){var r=a[i];null!=r&&o.push(r)}}),o},e.prototype.getAreaRects=function(e,t){var n=Math.ceil(.004*e.pageHeight);return t.map(function(e){return Rect.fromXYWH(e.getBlockHPos(),e.getBlockVPos(),e.getWidth(),e.getHeight()).increase(n)})},e}();o.AltoChapter=d;var n=function(){function e(e,t,n){this.altoRef=e,this.begin=t,this.end=n}return e.prototype.contains=function(e,t){var n=e.indexOf(t);return n>=e.indexOf(this.begin)&&n<=e.indexOf(this.end)},e}();o.MetsArea=n})((r=e.viewer||(e.viewer={})).components||(r.components={}))}(mycore||(mycore={})),addViewerComponent(mycore.viewer.components.MyCoReHighlightAltoComponent),function(e){var t,n,i,r;t=e.viewer||(e.viewer={}),n=t.widgets||(t.widgets={}),i=n.alto||(n.alto={}),r=function(){function e(e,t){var n=this;this.i18n=t,this.idChangeMap=new MyCoReMap,this.fileChangeMap=new MyCoReMap,this.idViewMap=new MyCoReMap,this.changeClickHandler=new Array,this.changeRemoveClickHandler=new Array,this.submitClickHandler=new Array,this.applyClickHandler=new Array,this.deleteClickHandler=new Array,this.downArrow=jQuery("\n<span class='fas fa-caret-down sortArrow'>\n</span> \n"),this.upArrow=jQuery("    \n<span class='fas fa-caret-up sortArrow'>\n</span> \n"),this.widgetElement=jQuery(this.createHTML()),this.widgetElement.appendTo(e),this.tableContainer=this.widgetElement.find("tbody.table-line-container"),this.buttonContainer=this.widgetElement.find("div.button-group-container"),this.changeWordButton=this.widgetElement.find("button.changeWord"),this.submitButton=this.widgetElement.find(".submit-button"),this.applyButton=this.widgetElement.find(".apply-button"),this.deleteButton=this.widgetElement.find(".delete-button"),this.pageHeading=this.widgetElement.find("[data-sort=pageHeading]"),this.actionHeading=this.widgetElement.find("[data-sort=actionHeading]"),this.infoHeading=this.widgetElement.find("[data-sort=infoHeading]"),this.pageHeading.click(this.getSortClickEventHandler("pageHeading")),this.actionHeading.click(this.getSortClickEventHandler("actionHeading")),this.infoHeading.click(this.getSortClickEventHandler("infoHeading")),this.submitButton.click(function(){n.submitClickHandler.forEach(function(e){e()})}),this.applyButton.click(function(){n.applyClickHandler.forEach(function(e){e()})}),this.deleteButton.click(function(){n.deleteClickHandler.forEach(function(e){e()})})}return e.prototype.enableApplyButton=function(e){void 0===e&&(e=!0),e?this.applyButton.show():this.applyButton.hide()},e.prototype.addChangeClickedEventHandler=function(e){this.changeClickHandler.push(e)},e.prototype.addSubmitClickHandler=function(e){this.submitClickHandler.push(e)},e.prototype.addApplyClickHandler=function(e){this.applyClickHandler.push(e)},e.prototype.addDeleteClickHandler=function(e){this.deleteClickHandler.push(e)},e.prototype.addChangeRemoveClickHandler=function(e){this.changeRemoveClickHandler.push(e)},e.prototype.getSortClickEventHandler=function(n){var i=this;return function(e){var t=i.getCurrentSortMethod();null==t||t.sortBy!==n?i.sortBy(n,!0):i.sortBy(n,!t.down)}},e.prototype.getCurrentSortMethod=function(){var e,t;return 0<(e=(t=this.downArrow).parent()).length||0<(e=(t=this.upArrow).parent()).length?{sortBy:e.attr("data-sort"),down:t[0]===this.downArrow[0]}:null},e.prototype.sortBy=function(e,t){var n=this;this.downArrow.detach(),this.upArrow.detach();var i=this.widgetElement.find("[data-sort="+e+"]");t?i.append(this.downArrow):i.append(this.upArrow);var r=[];this.idViewMap.forEach(function(e,t){t.detach(),r.push(t)}),r.sort(this.getSortFn(e,t)).forEach(function(e){n.tableContainer.append(e)})},e.prototype.getSortFn=function(r,a){var o=this,s=["action","pageHeading","actionHeading","infoHeading"];switch(r){case s[1]:return function(e,t){var n=o.idChangeMap.get(e.attr("data-id")).pageOrder,i=o.idChangeMap.get(t.attr("data-id")).pageOrder;return(a?1:-1)*(n-i)};case s[2]:case s[3]:return function(e,t){var n=jQuery(e.children("td").get(s.indexOf(r))).text(),i=jQuery(t.children("td").get(s.indexOf(r))).text();return(a?1:-1)*n.localeCompare(i)}}return function(e,t){return-1}},e.prototype.createHTML=function(){return'\n<div class="alto-editor-widget container-fluid">\n    <h3 class="small-heading">'+this.getLabel("altoWidget.heading")+'</h3>     \n    <div class="btn-toolbar edit">\n        <div class="btn-group btn-group-xs button-group-container">\n            <button type="button" class="btn btn-secondary changeWord">'+this.getLabel("altoWidget.changeWord")+'</button>\n        </div>\n    </div>\n    <h3 class="small-heading">'+this.getLabel("altoWidget.changesHeading")+'</h3>\n    <div class="table-responsive">\n        <table class="table table-condensed">\n            <thead>\n                <tr>\n                    <th></th>\n                    <th data-sort="pageHeading">'+this.getLabel("altoWidget.table.page")+'</th>\n                    <th data-sort="actionHeading">'+this.getLabel("altoWidget.table.action")+'</th>\n                    <th data-sort="infoHeading">'+this.getLabel("altoWidget.table.info")+'</th>\n                </tr>\n            </thead>\n            <tbody class="table-line-container">\n                \n            </tbody>\n        </table>\n    </div>\n    <div class="btn-toolbar action">\n        <div class="btn-group btn-group-xs button-group-container">\n            <button type="button" class="btn btn-primary apply-button">'+this.getLabel("altoWidget.apply")+'</button>\n            <button type="button" class="btn btn-success submit-button">'+this.getLabel("altoWidget.submit")+'</button>\n            <button type="button" class="btn btn-danger delete-button">'+this.getLabel("altoWidget.delete")+"</button>\n        </div>\n    </div>\n</div>\n"},e.prototype.getLabel=function(e){return this.i18n.getTranslation(e)},e.prototype.hasChange=function(e){return this.idChangeMap.has(e)},e.prototype.getChange=function(e){return this.idChangeMap.get(e)},e.prototype.getChanges=function(){return this.idChangeMap},e.prototype.getChangesInFile=function(e){return this.fileChangeMap.get(e)||[]},e.prototype.addChange=function(e,t){if(-1==this.idChangeMap.values.indexOf(t)){this.idChangeMap.set(e,t);var n=this.fileChangeMap.get(t.file);this.fileChangeMap.has(t.file)||(n=[],this.fileChangeMap.set(t.file,n)),n.push(t),this.addRow(e,t)}},e.prototype.addRow=function(e,t){var n=this,i=jQuery('\n<tr data-id="'+e+'">\n    '+this.getChangeHTMLContent(t)+"\n</tr>\n"),r=this.getCurrentSortMethod();if(null!=r){var a=this.getSortFn(r.sortBy,r.down),o=!1;this.tableContainer.children("tr").each(function(e,t){var n=jQuery(t);o||-1!=a(i,n)||(i.insertBefore(n),o=!0)}),o||this.tableContainer.append(i)}else this.tableContainer.append(i);i.click(function(e){jQuery(e.target).hasClass("remove")?n.changeRemoveClickHandler.forEach(function(e){e(t)}):n.changeClickHandler.forEach(function(e){e(t)})}),this.idViewMap.set(e,i)},e.prototype.getChangeText=function(e){if(e.type==i.AltoWordChange.TYPE){var t=e;return t.from+" => "+t.to}},e.prototype.updateChange=function(e){var t=this.getChangeID(e);this.idViewMap.get(t).html(this.getChangeHTMLContent(e))},e.prototype.getChangeID=function(n){var i=null;return this.idChangeMap.forEach(function(e,t){t==n&&(i=e)}),i},e.prototype.getChangeHTMLContent=function(e){return'\n<td><span class="fas fa-ban remove"></span></td>\n<td>'+e.pageOrder+"</td>\n<td>"+this.i18n.getTranslation("altoWidget.change."+e.type)+"</td>\n<td>"+this.getChangeText(e)+"</td>\n"},e.prototype.removeChange=function(e){var t=this.getChangeID(e);if(this.idViewMap.get(t).remove(),this.idViewMap.remove(t),this.idChangeMap.remove(t),this.fileChangeMap.has(e.file))for(var n=this.fileChangeMap.get(e.file),i=0;-1!=(i=n.indexOf(e,i));)n.splice(i,1)},e}(),i.AltoEditorWidget=r}(mycore||(mycore={})),function(l){var c;(function(p){var t=l.viewer.components.events.WaitForEvent,e=l.viewer.components.events.ShowContentEvent,a=l.viewer.widgets.alto.AltoEditorWidget,u=l.viewer.widgets.alto.AltoWordChange,n=l.viewer.widgets.canvas.DesktopInputAdapter,o=l.viewer.components.events.PageLoadedEvent,i=function(i){function g(e,t){var n=i.call(this)||this;return n._settings=e,n._container=t,n.highlightWordLayer=new r(n),n.altoIDImageMap=new MyCoReMap,n.imageHrefAltoContentMap=new MyCoReMap,n.altoHrefImageHrefMap=new MyCoReMap,n.imageHrefAltoHrefMap=new MyCoReMap,n.initialHtmlApplyList=new Array,n.everythingLoadedSynchronize=Utils.synchronize([function(e){return null!=e._toolbarModel},function(e){return null!=e._languageModel},function(e){return null!=e._structureModel},function(e){return e._altoPresent}],function(e){e.completeLoaded()}),n.currentEditWord=null,n.beforeEditWord=null,n}return __extends(g,i),g.prototype.init=function(){var e=this;this.editorEnabled()&&(this.container=jQuery("<div></div>"),this.containerTitle=jQuery("<span>ALTO-Editor</span>"),this.trigger(new t(this,p.events.ProvideToolbarModelEvent.TYPE)),this.container.bind("iviewResize",function(){e.updateContainerSize()}))},g.prototype.editorEnabled=function(){return void 0!==this._settings.altoEditorPostURL&&null!=this._settings.altoEditorPostURL},g.prototype.handle=function(e){var n=this;if(e.type==p.events.StructureModelLoadedEvent.TYPE){var t=e;for(var i in this._structureModel=t.structureModel,this._structureImages=this._structureModel.imageList,this._structureImages){var r=this._structureImages[i],a=r.additionalHrefs.get("AltoHref");if(this._altoPresent=this._altoPresent||null!=a,this._altoPresent){if(null==a){console.warn("there is no alto.xml for "+r.href);continue}this.altoHrefImageHrefMap.set(a,r.href)}}this.everythingLoadedSynchronize(this)}if(e.type==p.events.LanguageModelLoadedEvent.TYPE){var o=e;this._languageModel=o.languageModel,this.everythingLoadedSynchronize(this)}if(e.type==p.events.ProvideToolbarModelEvent.TYPE){var s=e;this._toolbarModel=s.model,this._sidebarControllDropdownButton=s.model._sidebarControllDropdownButton,this.everythingLoadedSynchronize(this)}if(e.type==c.widgets.toolbar.events.DropdownButtonPressedEvent.TYPE&&e.childId===g.DROP_DOWN_CHILD_ID&&this.openEditor(),e.type==p.events.PageLoadedEvent.TYPE){var l=e,h=l.abstractPage.getHTMLContent();null!=h.value?this.updateHTML(l.abstractPage.id,h.value):h.addObserver({propertyChanged:function(e,t){n.updateHTML(l.abstractPage.id,t.value)}})}if(e.type==p.events.ShowContentEvent.TYPE){var d=e;d.containerDirection==p.events.ShowContentEvent.DIRECTION_WEST&&0==d.size&&this.toggleEditWord(!1)}if(e.type==p.events.RequestStateEvent.TYPE){var u=e;"altoChangePID"in this._settings&&null!=this._settings.altoChangePID&&u.stateMap.set("altoChangeID",this._settings.altoChangePID)}},g.prototype.openEditor=function(){this.trigger(new e(this,this.container,e.DIRECTION_WEST,400,this.containerTitle))},g.prototype.updateHTML=function(e,t){var n=this._structureModel.imageHrefImageMap.get(e),i=n.additionalHrefs.get("AltoHref");this.altoIDImageMap.set(t.getAttribute("data-id"),n),this.imageHrefAltoContentMap.set(n.href,t),this.imageHrefAltoHrefMap.set(n.href,i),this.syncChanges(t,i),this.isEditing()?this.applyConfidenceLevel(t):this.removeConfidenceLevel(t)},g.prototype.mouseClick=function(e,t){if(this.isEditing()){var n=t.target,i=parseInt(n.getAttribute("data-vpos")),r=parseInt(n.getAttribute("data-hpos")),a=parseInt(n.getAttribute("data-width")),o=parseInt(n.getAttribute("data-height"));if(!isNaN(i)&&!isNaN(r)){if(this.currentEditWord!==n){this.editWord(n,i,r,a,o);var s=document.createRange();s.selectNodeContents(this.currentEditWord);var l=window.getSelection();l.removeAllRanges(),l.addRange(s)}return}}t.preventDefault()},g.prototype.editWord=function(e,t,n,i,r){null!=this.currentEditWord&&this.applyEdit(this.currentEditWord,this.currentAltoID,this.currentOrder);var a=function(e){return null==e.getAttribute("data-id")?a(e.parentElement):e.getAttribute("data-id")},o=a(e);this.currentAltoID=o,this.currentOrder=this.altoIDImageMap.get(o).order,this.currentEditWord=e,this.beforeEditWord=e.innerText,this.currentEditWord.setAttribute("contenteditable","true"),this.highlightWordLayer.setHighlightedWord({vpos:t,hpos:n,width:i,height:r,id:this.currentAltoID}),this.trigger(new p.events.RedrawEvent(this))},g.prototype.keyDown=function(e){if(null!=this.currentEditWord){if(e.keyCode==g.ENTER_KEY)return void this.applyEdit(this.currentEditWord,this.currentAltoID,this.currentOrder);if(e.keyCode==g.ESC_KEY)return void this.abortEdit(this.currentEditWord)}},g.prototype.abortEdit=function(e){e.innerText=this.beforeEditWord,this.endEdit(e)},g.prototype.resetWordEdit=function(e){this.currentEditWord==e&&this.abortEdit(e),e.innerText=e.getAttribute("data-word"),e.classList.contains("edited")&&e.classList.remove("edited")},g.prototype.applyEdit=function(e,t,n){var i=parseInt(e.getAttribute("data-vpos")),r=parseInt(e.getAttribute("data-hpos")),a=parseInt(e.getAttribute("data-width")),o=parseInt(e.getAttribute("data-height")),s=e.innerHTML,l=this.calculateChangeKey(t,i,r),h=e.getAttribute("data-word");if(this.editorWidget.hasChange(l))d=this.editorWidget.getChange(l),h!==s?(d.to=s,this.editorWidget.updateChange(d)):(this.editorWidget.removeChange(d),e.classList.contains("edited")&&e.classList.remove("edited"));else if(h!==s){var d=new u(t,r,i,a,o,h,s,n);this.editorWidget.addChange(l,d),e.classList.add("edited")}this.endEdit(e)},g.prototype.calculateChangeKey=function(e,t,n){return e+"_"+t+"_"+n},g.prototype.endEdit=function(e){this.currentEditWord=this.currentOrder=this.currentAltoID=this.beforeEditWord=null,e.setAttribute("contenteditable","false"),this.highlightWordLayer.setHighlightedWord(null),viewerClearTextSelection(),this.trigger(new p.events.RedrawEvent(this))},Object.defineProperty(g.prototype,"handlesEvents",{get:function(){return this.editorEnabled()?[p.events.StructureModelLoadedEvent.TYPE,p.events.LanguageModelLoadedEvent.TYPE,p.events.ProvideToolbarModelEvent.TYPE,c.widgets.toolbar.events.DropdownButtonPressedEvent.TYPE,p.events.ImageChangedEvent.TYPE,p.events.PageLoadedEvent.TYPE,p.events.ShowContentEvent.TYPE,p.events.RequestStateEvent.TYPE]:[]},enumerable:!0,configurable:!0}),g.prototype.toggleEditWord=function(e){var t=this;if(void 0===e&&(e=null),null!=this.editorWidget){e=null==e?!this.editorWidget.changeWordButton.hasClass("active"):e;var n=this.editorWidget.changeWordButton;e?(n.addClass("active"),this.imageHrefAltoContentMap.values.forEach(function(e){t.applyConfidenceLevel(e)})):(n.removeClass("active"),null!=this.currentEditWord&&this.endEdit(this.currentEditWord),this.imageHrefAltoContentMap.values.forEach(function(e){t.removeConfidenceLevel(e)})),this.trigger(new p.events.TextEditEvent(this,e)),this.trigger(new p.events.RedrawEvent(this))}},g.prototype.isEditing=function(){return null!=this.editorWidget&&this.editorWidget.changeWordButton.hasClass("active")},g.prototype.completeLoaded=function(){var n=this;this._altoDropdownChildItem={id:g.DROP_DOWN_CHILD_ID,label:this._languageModel.getTranslation("altoEditor")},this._sidebarControllDropdownButton.children.push(this._altoDropdownChildItem),this._sidebarControllDropdownButton.children=this._sidebarControllDropdownButton.children,this.editorWidget=new a(this.container,this._languageModel),this.containerTitle.text(""+this._languageModel.getTranslation("altoEditor")),void 0!==this._settings.altoReviewer&&null!=this._settings.altoReviewer&&this._settings.altoReviewer&&this.editorWidget.enableApplyButton(!0),void 0!==this._settings.altoChanges&&null!=this._settings.altoChanges&&"wordChanges"in this._settings.altoChanges&&this._settings.altoChanges.wordChanges instanceof Array&&this._settings.altoChanges.wordChanges.forEach(function(e){e.pageOrder=n._structureModel.imageHrefImageMap.get(n.altoHrefImageHrefMap.get(e.file)).order,n.editorWidget.addChange(n.calculateChangeKey(e.file,e.hpos,e.vpos),e),n.initialHtmlApplyList.push(e)}),this.editorWidget.changeWordButton.click(function(e){n.toggleEditWord()}),this.editorWidget.addChangeClickedEventHandler(function(e){n.trigger(new p.events.ImageSelectedEvent(n,n._structureModel.imageHrefImageMap.get(n.altoHrefImageHrefMap.get(e.file))))});var e=function(e){n._settings.altoChangePID=e.pid,new l.viewer.widgets.modal.ViewerInfoModal(n._settings.mobile,"altoChanges.save.successful.title","altoChanges.save.successful.message").updateI18n(n._languageModel).show()},t=function(){n._settings.altoChangePID=null,n.trigger(new p.events.UpdateURLEvent(n)),window.location.reload(!0)},i=function(e){console.log(e);var t=n._settings.webApplicationBaseURL+"/modules/iview2/img/sad-emotion-egg.jpg";new l.viewer.widgets.modal.ViewerErrorModal(n._settings.mobile,"altoChanges.save.failed.title","altoChanges.save.failed.message",t).updateI18n(n._languageModel).show()},r=function(e){console.log(e);var t=n._settings.webApplicationBaseURL+"/modules/iview2/img/sad-emotion-egg.jpg";new l.viewer.widgets.modal.ViewerErrorModal(n._settings.mobile,"altoChanges.delete.failed.title","altoChanges.delete.failed.message",t).updateI18n(n._languageModel).show()};this.editorWidget.addSubmitClickHandler(function(){n.submitChanges(e,i)}),this.editorWidget.addApplyClickHandler(function(){new l.viewer.widgets.modal.ViewerConfirmModal(n._settings.mobile,"altoChanges.applyChanges.title","altoChanges.applyChanges.message",function(e){e&&n.submitChanges(function(e){n._settings.altoChangePID=e.pid,n.applyChanges(t,i)},i)}).updateI18n(n._languageModel).show()}),this.editorWidget.addDeleteClickHandler(function(){new l.viewer.widgets.modal.ViewerConfirmModal(n._settings.mobile,"altoChanges.removeChanges.title","altoChanges.removeChanges.message",function(e){if(n._settings.altoChangePID){var t=n._settings.altoEditorPostURL;t+="/delete/"+n._settings.altoChangePID,jQuery.ajax(t,{contentType:"application/json",type:"POST",success:function(){n._settings.altoChangePID=null,n.trigger(new p.events.UpdateURLEvent(n))},error:r})}n.editorWidget.getChanges().forEach(function(e,t){n.removeChange(t)})}).updateI18n(n._languageModel).show()}),this.editorWidget.addChangeRemoveClickHandler(function(t){new l.viewer.widgets.modal.ViewerConfirmModal(n._settings.mobile,"altoChanges.removeChange.title","altoChanges.removeChange.message",function(e){e&&n.removeChange(t)}).updateI18n(n._languageModel).show()}),this.trigger(new p.events.AddCanvasPageLayerEvent(this,2,this.highlightWordLayer)),this.trigger(new p.events.RequestDesktopInputEvent(this,new s(this))),this.trigger(new p.events.WaitForEvent(this,o.TYPE)),"altoEditor"===this._settings.leftShowOnStart&&this.openEditor(),this.updateContainerSize()},g.prototype.removeChange=function(e){this.editorWidget.removeChange(e);var t=this.altoHrefImageHrefMap.get(e.file);if(this.imageHrefAltoContentMap.has(t)){var n=this.imageHrefAltoContentMap.get(t);if(e.type===u.TYPE){var i=e,r=this.findChange(i,n);0==r.length?console.log("Could not find change "+i):this.resetWordEdit(r.get(0))}}this.trigger(new p.events.RedrawEvent(this))},g.prototype.applyChanges=function(e,t){var n=this._settings.altoEditorPostURL;n+="/apply/"+this._settings.altoChangePID,jQuery.ajax(n,{contentType:"application/json",type:"POST"}).done(e).fail(t)},g.prototype.submitChanges=function(e,t){var n={wordChanges:this.editorWidget.getChanges().values,derivateID:this._settings.derivate},i=this._settings.altoEditorPostURL;void 0!==this._settings.altoChangePID&&null!=this._settings.altoChangePID?i+="/update/"+this._settings.altoChangePID:i+="/store",jQuery.ajax(i,{data:this.prepareData(n),contentType:"application/json",type:"POST"}).done(e).fail(t)},g.prototype.prepareData=function(e){var t=JSON.parse(JSON.stringify(e));return t.wordChanges.forEach(function(e){"pageOrder"in e&&delete e.pageOrder}),JSON.stringify(t)},g.prototype.findChange=function(e,t){var n="[data-hpos="+e.hpos+"][data-vpos="+e.vpos+"][data-width="+e.width+"][data-height="+e.height+"]";return jQuery(t).find(n)},g.prototype.updateContainerSize=function(){this.container.css({height:this.container.parent().height()-this.containerTitle.parent().outerHeight()+"px","overflow-y":"scroll"})},g.prototype.drag=function(e,t,n,i){i.target!==this.currentEditWord&&i.preventDefault()},g.prototype.mouseDown=function(e,t){t.target!==this.currentEditWord&&t.preventDefault()},g.prototype.syncChanges=function(i,e){var r=this;this.editorWidget.getChangesInFile(e).forEach(function(e){if(e.type==u.TYPE){var t=e,n=r.findChange(t,i);0<n.length?(n[0].innerText=t.to,n.addClass("edited")):console.log("Could not find Change: "+e)}})},g.prototype.applyConfidenceLevel=function(e){jQuery(e).find("[data-wc]:not([data-wc='1'])").each(function(e,t){var n=jQuery(t);parseFloat(n.attr("data-wc"))<.9&&n.addClass("unconfident")})},g.prototype.removeConfidenceLevel=function(e){jQuery(e).find(".unconfident").removeClass("unconfident")},g.DROP_DOWN_CHILD_ID="altoButtonChild",g.ENTER_KEY=13,g.ESC_KEY=27,g}(p.ViewerComponent);p.MyCoReAltoEditorComponent=i;var s=function(n){function e(e){var t=n.call(this)||this;return t.editAltoComponent=e,t}return __extends(e,n),e.prototype.mouseDown=function(e,t){this.editAltoComponent.isEditing()&&this.editAltoComponent.mouseDown(e,t)},e.prototype.mouseUp=function(e,t){},e.prototype.mouseMove=function(e,t){},e.prototype.mouseClick=function(e,t){this.editAltoComponent.isEditing()&&this.editAltoComponent.mouseClick(e,t)},e.prototype.mouseDoubleClick=function(e,t){},e.prototype.keydown=function(e){this.editAltoComponent.keyDown(e)},e.prototype.mouseDrag=function(e,t,n,i){this.editAltoComponent.isEditing()&&this.editAltoComponent.drag(e,t,n,i)},e}(n);p.EditAltoInputListener=s;var r=function(){function o(e){this.component=e,this.highlightedWord=null}return o.prototype.getHighlightedWord=function(){return this.highlightedWord},o.prototype.setHighlightedWord=function(e){this.highlightedWord=e},o.prototype.draw=function(n,e,t,i){var r=this;if(!i){n.save(),null!=this.highlightedWord&&e==this.component.altoHrefImageHrefMap.get(this.highlightedWord.id)&&this.strokeWord(n,this.highlightedWord.hpos,this.highlightedWord.vpos,this.highlightedWord.width,this.highlightedWord.height,o.EDIT_HIGHLIGHT_COLOR);var a=this.component.imageHrefAltoHrefMap.get(e);void 0!==a&&this.component.editorWidget.getChangesInFile(a).forEach(function(e){if(e.type==u.TYPE){var t=e;r.strokeWord(n,t.hpos,t.vpos,t.width,t.height,o.EDITED_HIGHLIGHT_COLOR)}}),n.restore()}},o.prototype.strokeWord=function(e,t,n,i,r,a){var o=5*window.devicePixelRatio,s=o/2+5*devicePixelRatio;e.rect(t-s,n-s,i+2*s,r+2*s),e.strokeStyle=a,e.lineWidth=o,e.stroke()},o.EDIT_HIGHLIGHT_COLOR="#90EE90",o.EDITED_HIGHLIGHT_COLOR="#ADD8E6",o}();p.HighligtAltoWordCanvasPageLayer=r})((c=l.viewer||(l.viewer={})).components||(c.components={}))}(mycore||(mycore={})),addViewerComponent(mycore.viewer.components.MyCoReAltoEditorComponent),console.log("METS MODULE");