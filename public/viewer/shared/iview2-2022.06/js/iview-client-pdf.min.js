var mycore,__extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();!function(e){var t,n,o,i;t=e.viewer||(e.viewer={}),n=t.widgets||(t.widgets={}),o=n.pdf||(n.pdf={}),i=function(a){function e(e,t,n,o,i,r){var s=a.call(this,e,t,n,o,i,!0)||this;return s.refPageMap=r,s}return __extends(e,a),e}(t.model.StructureModel),o.PDFStructureModel=i}(mycore||(mycore={})),function(e){var l,t,n,o;l=e.viewer||(e.viewer={}),t=l.widgets||(l.widgets={}),n=t.pdf||(t.pdf={}),o=function(){function r(e,t){this._document=e,this._name=t,this._startPage=-1,this._structureModel=null,this._chapterPageMap=new MyCoReMap,this._pages=new Array,this._pageCount=0,this._refPageMap=new MyCoReMap,this._idPageMap=new MyCoReMap,this._promise=new ViewerPromise,this._outlineTodoCount=0,this._pageCount=this._document.numPages}return r.prototype.resolve=function(){return this._resolvePages(),this._resolveOutline(),this._resolveStartPage(),this._promise},r.prototype._resolveStartPage=function(){var t=this;try{this._document.getOpenAction().then(function(e){if(null===e||null===e.dest)return t._startPage=1,void t.checkResolvable();t._document.getPageIndex(e.dest[0]).then(function(e){t._startPage=e+1,t.checkResolvable()},function(){t._startPage=1,t.checkResolvable()})})}catch(e){this._startPage=1,this.checkResolvable()}},r.prototype._resolvePages=function(){var e=this;this._loadedPageCount=0;for(var t=1;t<=e._pageCount;t++){var n=this._createThumbnailDrawer(t),o=new MyCoReMap;o.set(r.PDF_TEXT_HREF,t+"");var i=new l.model.StructureImage("pdfPage",t+"",t,null,t+"","pdfPage",n,o);e._pages.push(i),e._idPageMap.set(t,i)}},r.prototype._createThumbnailDrawer=function(e){var n=this,o=null,i=new Array;return function(t){null==o?(i.push(function(e){null==o&&(o=e),t(e)}),1==i.length&&n._document.getPage(e).then(function(e){n._renderPage(i,e)})):t(o)}},r.prototype._renderPage=function(o,e){var i=this,t=new Size2D(e.view[2]-e.view[0],e.view[3]-e.view[1]),n=256/Math.max(t.width,t.height),r=e.getViewport({scale:n}),s=document.createElement("canvas"),a=s.getContext("2d");s.width=t.width*n,s.height=t.height*n,e.render({canvasContext:a,viewport:r}).promise.then(function(e){i._loadedPageCount++;var t=s.toDataURL();for(var n in a=s=null,o)(0,o[n])(t)})},r.prototype._resolveOutline=function(){var t=this;this._document.getOutline().then(function(e){t._outline=e,t.resolveStructure()})},r.prototype.getPageNumberFromDestination=function(e,t){var n=this;("string"==typeof e?this._document.getDestination(e):window.Promise.resolve(e)).then(function(e){e instanceof Array?n._document.getPageIndex(e[0]).then(function(e){void 0!==e&&null!=e&&(e>n._pageCount?console.error("Destination outside of Document! ("+e+")"):t(e+1))}):console.error("Invalid destination "+e)})},r.prototype.getChapterFromOutline=function(e,t,n){var o=this,i=new Array;for(var r in t){var s=t[r],a=function(t){return function(e){o.getPageNumberFromDestination(t.dest,e)}}(s),u=new l.model.StructureChapter(e,"pdfChapter",Utils.hash(s.title+n++).toString(),s.title,null,null,a),h=this.getChapterFromOutline(u,s.items,n++);u.chapter=h,i.push(u)}return i},r.prototype.checkResolvable=function(){null!==this._structureModel&&0===this._outlineTodoCount&&-1!==this._startPage&&(this._structureModel.startPage=this._startPage,this._promise.resolve(this._structureModel))},r.prototype.resolveStructure=function(){void 0!==this._outline&&(this._rootChapter=new l.model.StructureChapter(null,"pdf","0",this._name,null,null,function(){return 1}),this._rootChapter.chapter=this.getChapterFromOutline(this._rootChapter,this._outline,1),this._structureModel=new n.PDFStructureModel(this._rootChapter,this._pages,this._chapterPageMap,new MyCoReMap,new MyCoReMap,this._refPageMap),this.checkResolvable())},r.destToString=function(e){return e.gen+" "+e.num},r.PDF_TEXT_HREF="pdfText",r}(),n.PDFStructureBuilder=o}(mycore||(mycore={})),function(e){var t,n;t=e.viewer||(e.viewer={}),function(e){var t=function(){function f(e,t,n){this.id=e,this.pdfPage=t,this.builder=n,this._frontBuffer=document.createElement("canvas"),this._backBuffer=document.createElement("canvas"),this._timeOutIDHolder=null,this._bbScale=-1,this._fbScale=-1,this._promiseRunning=!1,this._textData=null;var o=(this.pdfPage.view[2]-this.pdfPage.view[0])*f.CSS_UNITS,i=(this.pdfPage.view[3]-this.pdfPage.view[1])*f.CSS_UNITS,r=t.rotate;90!=r&&270!=r||(o^=i,o^=i^=o),this._rotation=r,this.size=new Size2D(o,i)}return f.prototype.resolveTextContent=function(e){var c=this;if(null==this._textData){var d={content:[],links:[],internLinks:[]};this._textData=d;var t=!1,r=!1,s=function(){return t&&r?e(d):null};this.pdfPage.getAnnotations().then(function(e){if(r=!0,0<e.length)for(var t=0,n=e;t<n.length;t++){var o=n[t];if(2==o.annotationType&&"Link"==o.subtype)if("url"in o)d.links.push({rect:c.getRectFromAnnotation(o),url:o.url});else if("dest"in o){var i=function(e){return function(t){c.builder.getPageNumberFromDestination(e.dest,function(e){t(e+"")})}}(o);d.internLinks.push({rect:c.getRectFromAnnotation(o),pageNumberResolver:i})}}s()}),this.pdfPage.getTextContent().then(function(l){t=!0,l.items.forEach(function(e){var t,n,o=c.pdfPage.getViewport({scale:1}),i=pdfjsLib.Util.transform(o.transform,e.transform),r=l.styles[e.fontName],s=Math.atan2(i[1],i[0])+(1==r.vertical?Math.PI/2:0),a=Math.sqrt(i[2]*i[2]+i[3]*i[3]),u=a;r.ascent?u=r.ascent*u:r.descent&&(u=(1+r.descent)*u),t=i[4]*f.CSS_UNITS,n=i[5]*f.CSS_UNITS;var h=new g(s,new Size2D(e.width,e.height).scale(f.CSS_UNITS).roundDown(),a,e.str,new Position2D(t,n),r.fontFamily,c.id);d.content.push(h)}),s()},function(e){t=!0,console.error("PDF Page Text Content rejected"),console.error("Reason: "+e),s()})}else e(this._textData)},f.prototype.getRectFromAnnotation=function(e){return new Rect(new Position2D(e.rect[0]*f.CSS_UNITS,this.size.height-e.rect[1]*f.CSS_UNITS-(e.rect[3]-e.rect[1])*f.CSS_UNITS),new Size2D((e.rect[2]-e.rect[0])*f.CSS_UNITS,(e.rect[3]-e.rect[1])*f.CSS_UNITS))},f.prototype.draw=function(e,t,n,o,i){if((!o&&n!==this._fbScale||-1===this._fbScale)&&(this._promiseRunning||this._updateBackBuffer(n)),-1!=this._fbScale){var r=t.scale(this._fbScale),s=t.scale(n),a=r.size.width,u=r.size.height;0<a&&0<u&&(e.save(),e.drawImage(this._frontBuffer,r.pos.x,r.pos.y,Math.min(a,this._frontBuffer.width),Math.min(u,this._frontBuffer.height),0,0,s.size.width,s.size.height),e.restore())}},f.prototype._updateBackBuffer=function(e){var t=this,n=this.pdfPage.getViewport({scale:e*f.CSS_UNITS,rotation:this._rotation}),o=this.pdfPage.render({canvasContext:this._backBuffer.getContext("2d"),viewport:n});this._bbScale=e,this._promiseRunning=!0,this._backBuffer.width=this.size.width*e,this._backBuffer.height=this.size.height*e,o.promise.then(function(e){t._promiseRunning=!1,t._swapBuffers(),t.refreshCallback()},function(e){console.log("Render Error",e)})},f.prototype._swapBuffers=function(){var e=null;e=this._backBuffer,this._backBuffer=this._frontBuffer,this._frontBuffer=e,e=this._bbScale,this._bbScale=this._fbScale,this._fbScale=e},f.prototype.toString=function(){return this.pdfPage.pageNumber},f.prototype.clear=function(){this._frontBuffer.width=this._backBuffer.width=1,this._frontBuffer.width=this._backBuffer.width=1,this._bbScale=-1,this._fbScale=-1,this._promiseRunning=!1},f.CSS_UNITS=96/72,f}();e.PDFPage=t;var g=function(){function e(e,t,n,o,i,r,s){this.angle=e,this.size=t,this.fontSize=n,this.text=o,this.fontFamily=r,this.pageHref=s,this.fromBottomLeft=!1,this.pos=new Position2D(i.x,i.y-n)}return e.prototype.toString=function(){return this.pageHref.toString+"-"+this.pos.toString()+"-"+this.text.toString()+"-"+this.angle.toString()},e}()}((n=t.widgets||(t.widgets={})).canvas||(n.canvas={}))}(mycore||(mycore={})),function(i){var a,u,e;a=i.viewer||(i.viewer={}),u=a.components||(a.components={}),e=function(n){function e(e,t){var o=n.call(this)||this;return o._settings=e,o.container=t,o._structure=null,o._pageCache=new MyCoReMap,o._errorModalSynchronize=Utils.synchronize([function(e){return null!=e._languageModel&&e.error}],function(e){var t=e._languageModel.getFormatedTranslation("noPDF","<a href='mailto:"+o._settings.adminMail+"'>"+o._settings.adminMail+"</a>"),n=e._languageModel.getTranslation("noPDFShort");new i.viewer.widgets.modal.ViewerErrorModal(o._settings.mobile,n,t,o._settings.webApplicationBaseURL+"/modules/iview2/img/sad-emotion-egg.jpg",o.container[0]).show(),e.trigger(new i.viewer.components.events.ShowContentEvent(o,jQuery(),i.viewer.widgets.layout.IviewBorderLayout.DIRECTION_WEST,0))}),o.error=!1,o.toolbarLanguageSync=Utils.synchronize([function(e){return null!=e._toolbarModel},function(e){return null!=e._languageModel}],function(e){e.addDownloadButton()}),o._toolbarModel=null,o._languageModel=null,pdfjsLib.disableAutoFetch=!0,pdfjsLib.cMapUrl=o._settings.webApplicationBaseURL+"/modules/iview2/cmaps/",pdfjsLib.cMapPacked=!0,pdfjsLib.disableOpenActionDestination=!1,o}return __extends(e,n),e.prototype.init=function(){var n=this;if("pdf"==this._settings.doctype){this._pdfUrl=ViewerFormatString(this._settings.pdfProviderURL,{filePath:this._settings.filePath,derivate:this._settings.derivate}),pdfjsLib.GlobalWorkerOptions.workerSrc=this._settings.pdfWorkerURL;var o=this,e=this._pdfUrl;pdfjsLib.getDocument(e).promise.then(function(e){n._pdfDocument=e,o._structureBuilder=new i.viewer.widgets.pdf.PDFStructureBuilder(o._pdfDocument,n._settings.filePath);var t=o._structureBuilder.resolve();t.then(function(e){o._structure=e;var t=new u.events.StructureModelLoadedEvent(o,o._structure);o._structureModelLoadedEvent=t,o._pageCount=e._imageList.length,o.trigger(t)}),t.onreject(function(e){n.error=!0,n._errorModalSynchronize(n)})},function(e){console.log("error")}),this.trigger(new u.events.WaitForEvent(this,u.events.ProvideToolbarModelEvent.TYPE)),this.trigger(new u.events.WaitForEvent(this,u.events.LanguageModelLoadedEvent.TYPE))}},e.prototype.handle=function(e){var n=this;if(e.type==u.events.RequestPageEvent.TYPE){var o=e,t=o._pageId;this._pageCache.has(Number(t))?o._onResolve(t,this._pageCache.get(Number(t))):this._pdfDocument.getPage(Number(t)).then(function(e){var t=new a.widgets.canvas.PDFPage(o._pageId,e,n._structureBuilder);n._pageCache.set(Number(o._pageId),t),o._onResolve(o._pageId,t)},function(e){console.error("PDF Page Request rejected"),console.error("Reason: "+e)})}if(e.type==u.events.RequestTextContentEvent.TYPE){var i=e;this.handle(new u.events.RequestPageEvent(this,i._href,function(e,t){t.resolveTextContent(function(e){i._onResolve(i._href,e)})}))}if(e.type==u.events.ProvideToolbarModelEvent.TYPE){var r=e;this._toolbarModel=r.model,this.toolbarLanguageSync(this)}if(e.type==u.events.LanguageModelLoadedEvent.TYPE){var s=e;this._languageModel=s.languageModel,this.toolbarLanguageSync(this),this._errorModalSynchronize(this)}e.type==a.widgets.toolbar.events.ButtonPressedEvent.TYPE&&"PdfDownloadButton"==e.button.id&&window.location.assign(this._pdfUrl+"?dl")},Object.defineProperty(e.prototype,"handlesEvents",{get:function(){return"pdf"==this._settings.doctype?[u.events.RequestPageEvent.TYPE,u.events.ProvideToolbarModelEvent.TYPE,u.events.LanguageModelLoadedEvent.TYPE,a.widgets.toolbar.events.ButtonPressedEvent.TYPE,u.events.RequestTextContentEvent.TYPE]:[]},enumerable:!0,configurable:!0}),e.prototype.addDownloadButton=function(){this._toolbarModel._actionControllGroup.addComponent(new i.viewer.widgets.toolbar.ToolbarButton("PdfDownloadButton","",this._languageModel.getTranslation("toolbar.pdfDownload"),"download"))},e}(u.ViewerComponent),u.MyCoRePDFViewerComponent=e}(mycore||(mycore={})),addViewerComponent(mycore.viewer.components.MyCoRePDFViewerComponent),console.log("PDF MODULE");