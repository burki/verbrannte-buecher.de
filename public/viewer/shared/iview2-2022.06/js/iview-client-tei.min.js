var mycore,__extends=this&&this.__extends||function(){var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();!function(e){var t,n,r,o;t=e.viewer||(e.viewer={}),n=t.widgets||(t.widgets={}),r=n.tei||(n.tei={}),o=function(){function e(e,t,n,r,o){this._id=e,this._label=t,this.mapping=n,this.contentLocation=r,this.teiStylesheet=o}return e.prototype.getId=function(){return this._id},e.prototype.getLabel=function(){return this._label},e.prototype.resolveLayer=function(e,r){if(this.mapping.has(e)){var t={async:!0,success:function(e,t,n){r(!0,jQuery(e))}};jQuery.ajax(this.contentLocation+this.mapping.get(e)+"?XSL.Style="+this.teiStylesheet,t)}else r(!1)},e}(),r.TEILayer=o}(mycore||(mycore={})),function(e){var a,c,t;a=e.viewer||(e.viewer={}),c=a.components||(a.components={}),t=function(n){function e(e){var t=n.call(this)||this;return t._settings=e,t._model=null,t.contentLocation=null,t.contentLocation=t._settings.webApplicationBaseURL+"/servlets/MCRDerivateContentTransformerServlet/"+t._settings.derivate+"/",t}return __extends(e,n),e.prototype.init=function(){"mets"==this._settings.doctype&&this.trigger(new c.events.WaitForEvent(this,c.events.StructureModelLoadedEvent.TYPE))},e.prototype.handle=function(e){var n=this;if(e.type!=c.events.StructureModelLoadedEvent.TYPE);else{var t=e;this._model=t.structureModel;var r=new MyCoReMap,o=new MyCoReMap,i=new Array;t.structureModel._imageList.forEach(function(r){r.additionalHrefs.forEach(function(e,t){if(0==e.indexOf("TEI.")){var n=e.substr("TEI.".length).toLocaleLowerCase();o.has(n)||o.set(n,new MyCoReMap),o.get(n).set(r.href,t),-1==i.indexOf(n)&&i.push(n)}})}),r.isEmpty()||this.trigger(new c.events.ProvideLayerEvent(this,new a.widgets.tei.TEILayer("transcription","layer.transcription",r,this.contentLocation,this._settings.teiStylesheet||"html")));var s=["de","en"];0!=i.length&&i.sort(function(e,t){return s.indexOf(e)-s.indexOf(t)}).forEach(function(e){var t=o.get(e);n.trigger(new c.events.ProvideLayerEvent(n,new a.widgets.tei.TEILayer(e,"layer."+e,t,n.contentLocation,n._settings.teiStylesheet||"html")))})}},Object.defineProperty(e.prototype,"handlesEvents",{get:function(){return"mets"==this._settings.doctype?[c.events.StructureModelLoadedEvent.TYPE]:[]},enumerable:!0,configurable:!0}),e}(c.ViewerComponent),c.MyCoReTEILayerProvider=t}(mycore||(mycore={})),addViewerComponent(mycore.viewer.components.MyCoReTEILayerProvider);